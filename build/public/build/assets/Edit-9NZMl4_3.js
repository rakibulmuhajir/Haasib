import{d as z,x as Q,s as j,c as v,a as l,u as e,h as G,w as s,j as L,b as n,o as c,t as p,y as H,e as r,F as V,r as U,i as N,B as J,f as q}from"./app-B-wLZQl0.js";import{_ as K}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as g}from"./index-D8JUok4n.js";import{_}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_ as m}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{_ as C,a as k,b as S,c as A,d as E}from"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import{u as O}from"./useFormFeedback-CE35LO4q.js";import{P as W}from"./plus-C63jdNg7.js";import{T as X}from"./trash-2-BxVbfljz.js";import{S as M}from"./save-CBmuHaqJ.js";import{A as Y}from"./arrow-left-DSX0n2_N.js";import{F as Z}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./loader-circle-BSwxCoSE.js";import"./createLucideIcon-CbxkoCx6.js";import"./info-_qQ0Rbsf.js";import"./circle-check-YKnAkXoj.js";import"./useForwardExpose-Ca12vFmR.js";import"./index-a73qSWOM.js";import"./VisuallyHidden-BZkMfMV2.js";import"./Collection-DN_gmv-a.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./check-DogY6QNG.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./file-text-CFHWSPvd.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";const h={key:0,class:"mb-6"},ee={class:"rounded-lg border border-yellow-200 bg-yellow-50 p-4"},te={class:"flex items-center"},de={class:"ml-2"},le={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},ie={class:"grid gap-4 md:grid-cols-2"},ne={class:"md:col-span-2"},se={class:"space-y-3"},oe={class:"flex items-center justify-between"},ae={class:"space-y-4"},re={class:"md:col-span-2"},ue={key:0,class:"text-xs text-red-500 mt-1"},me={class:"md:col-span-2"},ce={class:"flex items-end justify-between gap-2"},pe={class:"grid gap-2 md:w-1/2"},_e={class:"flex justify-between text-sm"},fe={class:"flex justify-between text-sm"},be={class:"flex justify-between text-sm"},ve={class:"flex justify-between text-base font-semibold"},xe={class:"flex justify-end gap-3"},et=z({__name:"Edit",props:{company:{},credit:{},vendors:{},expenseAccounts:{},apAccounts:{}},setup(y){const o=y,B=[{title:"Dashboard",href:`/${o.company.slug}`},{title:"Vendor Credits",href:`/${o.company.slug}/vendor-credits`},{title:o.credit.credit_number,href:`/${o.company.slug}/vendor-credits/${o.credit.id}`},{title:"Edit"}],{showSuccess:P,showError:F}=O(),T=()=>({description:"",quantity:1,unit_price:0,tax_rate:0,discount_rate:0,expense_account_id:""}),i=Q({vendor_id:o.credit.vendor_id,bill_id:o.credit.bill_id,credit_date:o.credit.credit_date,amount:o.credit.amount,currency:o.credit.currency,base_currency:o.credit.base_currency,exchange_rate:o.credit.exchange_rate||"",reason:o.credit.reason,notes:o.credit.notes,ap_account_id:o.credit.ap_account_id||"",status:o.credit.status,line_items:o.credit.line_items&&o.credit.line_items.length>0?o.credit.line_items:[T()]}),w=j(()=>{const b=i.line_items.reduce((a,f)=>a+(Number(f.quantity)||0)*(Number(f.unit_price)||0),0),t=i.line_items.reduce((a,f)=>{const $=(Number(f.quantity)||0)*(Number(f.unit_price)||0);return a+$*((Number(f.tax_rate)||0)/100)},0),d=i.line_items.reduce((a,f)=>{const $=(Number(f.quantity)||0)*(Number(f.unit_price)||0);return a+$*((Number(f.discount_rate)||0)/100)},0),x=b+t-d;return{subtotal:b,tax:t,discount:d,total:x}}),R=()=>i.line_items.push(T()),I=b=>{i.line_items.length>1&&i.line_items.splice(b,1)},D=()=>{if(!i.amount||i.amount<=0){F("Amount must be greater than zero");return}const b=i.line_items.filter(d=>{const x=d.description&&d.description.trim()!=="";return d.quantity&&Number(d.quantity)>0,d.unit_price&&Number(d.unit_price)>=0,x}),t={vendor_id:i.vendor_id==="__none"?null:i.vendor_id,bill_id:i.bill_id||null,credit_date:i.credit_date,amount:i.amount,currency:i.currency,base_currency:i.base_currency,exchange_rate:i.exchange_rate||null,reason:i.reason,notes:i.notes||null,ap_account_id:i.ap_account_id==="__none"?null:i.ap_account_id||null,status:i.status};b.length>0&&(t.line_items=b.map(d=>({description:d.description.trim(),quantity:Number(d.quantity)||1,unit_price:Number(d.unit_price)||0,tax_rate:Number(d.tax_rate)||0,discount_rate:Number(d.discount_rate)||0,expense_account_id:d.expense_account_id==="__none"?null:d.expense_account_id||null}))),q.put(`/${o.company.slug}/vendor-credits/${o.credit.id}`,t,{preserveScroll:!0,onStart:()=>{i.processing=!0},onFinish:()=>{i.processing=!1},onSuccess:()=>{P("Vendor credit updated successfully"),q.visit(`/${o.company.slug}/vendor-credits/${o.credit.id}`)},onError:d=>{console.error("Validation errors:",d),F(d),i.errors=d}})},u=j(()=>["draft","received"].includes(o.credit.status));return(b,t)=>(c(),v(V,null,[l(e(G),{title:"Edit Vendor Credit"}),l(K,{title:"Edit Vendor Credit",breadcrumbs:B,icon:e(Z)},{actions:s(()=>[l(e(g),{variant:"outline",onClick:t[0]||(t[0]=d=>e(q).get(`/${y.company.slug}/vendor-credits/${y.credit.id}`))},{default:s(()=>[l(e(Y),{class:"mr-2 h-4 w-4"}),t[9]||(t[9]=r(" Cancel ",-1))]),_:1}),l(e(g),{onClick:D,disabled:e(i).processing||!u.value},{default:s(()=>[l(e(M),{class:"mr-2 h-4 w-4"}),t[10]||(t[10]=r(" Save Changes ",-1))]),_:1},8,["disabled"])]),default:s(()=>[u.value?L("",!0):(c(),v("div",h,[n("div",ee,[n("div",te,[t[11]||(t[11]=n("div",{class:"text-sm font-medium text-yellow-800"}," This vendor credit cannot be edited in its current status. ",-1)),n("div",de,[n("span",le,p(y.credit.status),1)])])])])),n("form",{class:"space-y-6",onSubmit:H(D,["prevent"])},[n("div",ie,[n("div",null,[l(e(m),{for:"vendor_id"},{default:s(()=>[...t[12]||(t[12]=[r("Vendor",-1)])]),_:1}),l(e(C),{modelValue:e(i).vendor_id,"onUpdate:modelValue":t[1]||(t[1]=d=>e(i).vendor_id=d),required:"",disabled:!u.value},{default:s(()=>[l(e(k),{id:"vendor_id"},{default:s(()=>[l(e(S),{placeholder:"Select vendor"})]),_:1}),l(e(A),null,{default:s(()=>[(c(!0),v(V,null,U(y.vendors,d=>(c(),N(e(E),{key:d.id,value:d.id},{default:s(()=>[r(p(d.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])]),n("div",null,[l(e(m),{for:"credit_date"},{default:s(()=>[...t[13]||(t[13]=[r("Credit Date",-1)])]),_:1}),l(e(_),{id:"credit_date",modelValue:e(i).credit_date,"onUpdate:modelValue":t[2]||(t[2]=d=>e(i).credit_date=d),type:"date",required:"",disabled:!u.value},null,8,["modelValue","disabled"])]),n("div",null,[l(e(m),{for:"amount"},{default:s(()=>[...t[14]||(t[14]=[r("Amount",-1)])]),_:1}),l(e(_),{id:"amount",modelValue:e(i).amount,"onUpdate:modelValue":t[3]||(t[3]=d=>e(i).amount=d),modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",required:"",disabled:!u.value},null,8,["modelValue","disabled"])]),n("div",null,[l(e(m),{for:"currency"},{default:s(()=>[...t[15]||(t[15]=[r("Currency",-1)])]),_:1}),l(e(_),{id:"currency",modelValue:e(i).currency,"onUpdate:modelValue":t[4]||(t[4]=d=>e(i).currency=d),maxlength:"3",disabled:!u.value},null,8,["modelValue","disabled"])]),n("div",null,[l(e(m),{for:"exchange_rate"},{default:s(()=>[...t[16]||(t[16]=[r("Exchange Rate",-1)])]),_:1}),l(e(_),{id:"exchange_rate",modelValue:e(i).exchange_rate,"onUpdate:modelValue":t[5]||(t[5]=d=>e(i).exchange_rate=d),placeholder:"Required if currency != base",disabled:!u.value},null,8,["modelValue","disabled"])]),n("div",null,[l(e(m),{for:"reason"},{default:s(()=>[...t[17]||(t[17]=[r("Reason",-1)])]),_:1}),l(e(_),{id:"reason",modelValue:e(i).reason,"onUpdate:modelValue":t[6]||(t[6]=d=>e(i).reason=d),required:"",disabled:!u.value},null,8,["modelValue","disabled"])]),n("div",null,[l(e(m),{for:"ap_account_id"},{default:s(()=>[...t[18]||(t[18]=[r("AP Account",-1)])]),_:1}),l(e(C),{modelValue:e(i).ap_account_id,"onUpdate:modelValue":t[7]||(t[7]=d=>e(i).ap_account_id=d),disabled:!u.value},{default:s(()=>[l(e(k),{id:"ap_account_id"},{default:s(()=>[l(e(S),{placeholder:"Default AP"})]),_:1}),l(e(A),null,{default:s(()=>[(c(!0),v(V,null,U(o.apAccounts,d=>(c(),N(e(E),{key:d.id,value:d.id},{default:s(()=>[r(p(d.code)+" — "+p(d.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])]),n("div",ne,[l(e(m),{for:"notes"},{default:s(()=>[...t[19]||(t[19]=[r("Notes",-1)])]),_:1}),l(e(_),{id:"notes",modelValue:e(i).notes,"onUpdate:modelValue":t[8]||(t[8]=d=>e(i).notes=d),disabled:!u.value},null,8,["modelValue","disabled"])])]),n("div",se,[n("div",oe,[t[21]||(t[21]=n("div",{class:"text-lg font-semibold"},"Line Items (optional)",-1)),l(e(g),{type:"button",variant:"outline",onClick:R,disabled:!u.value},{default:s(()=>[l(e(W),{class:"mr-2 h-4 w-4"}),t[20]||(t[20]=r(" Add Line ",-1))]),_:1},8,["disabled"])]),t[28]||(t[28]=n("p",{class:"text-sm text-muted-foreground"}," Add line items for detailed tracking. Items without descriptions will be excluded. ",-1)),n("div",ae,[(c(!0),v(V,null,U(e(i).line_items,(d,x)=>(c(),v("div",{key:x,class:"grid gap-3 rounded border p-3 md:grid-cols-5"},[n("div",re,[l(e(m),null,{default:s(()=>[...t[22]||(t[22]=[r("Description ",-1),n("span",{class:"text-red-500"},"*",-1)])]),_:1}),l(e(_),{modelValue:d.description,"onUpdate:modelValue":a=>d.description=a,class:J({"border-red-300":!d.description||d.description.trim()===""}),placeholder:"Required for line item to be included",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","class","disabled"]),!d.description||d.description.trim()===""?(c(),v("p",ue," Description required - item will be excluded ")):L("",!0)]),n("div",null,[l(e(m),null,{default:s(()=>[...t[23]||(t[23]=[r("Qty",-1)])]),_:1}),l(e(_),{modelValue:d.quantity,"onUpdate:modelValue":a=>d.quantity=a,modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),n("div",null,[l(e(m),null,{default:s(()=>[...t[24]||(t[24]=[r("Unit Price",-1)])]),_:1}),l(e(_),{modelValue:d.unit_price,"onUpdate:modelValue":a=>d.unit_price=a,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),n("div",me,[l(e(m),null,{default:s(()=>[...t[25]||(t[25]=[r("Expense Account",-1)])]),_:1}),l(e(C),{modelValue:d.expense_account_id,"onUpdate:modelValue":a=>d.expense_account_id=a,disabled:!u.value},{default:s(()=>[l(e(k),null,{default:s(()=>[l(e(S),{placeholder:"Select account"})]),_:1}),l(e(A),null,{default:s(()=>[(c(!0),v(V,null,U(o.expenseAccounts,a=>(c(),N(e(E),{key:a.id,value:a.id},{default:s(()=>[r(p(a.code)+" — "+p(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),n("div",ce,[l(e(g),{type:"button",variant:"destructive",size:"icon",onClick:a=>I(x),disabled:!u.value},{default:s(()=>[l(e(X),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])]),n("div",null,[l(e(m),null,{default:s(()=>[...t[26]||(t[26]=[r("Tax %",-1)])]),_:1}),l(e(_),{modelValue:d.tax_rate,"onUpdate:modelValue":a=>d.tax_rate=a,modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),n("div",null,[l(e(m),null,{default:s(()=>[...t[27]||(t[27]=[r("Discount %",-1)])]),_:1}),l(e(_),{modelValue:d.discount_rate,"onUpdate:modelValue":a=>d.discount_rate=a,modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01",disabled:!u.value},null,8,["modelValue","onUpdate:modelValue","disabled"])])]))),128))])]),n("div",pe,[n("div",_e,[t[29]||(t[29]=n("span",null,"Subtotal",-1)),n("span",null,p(w.value.subtotal.toFixed(2)),1)]),n("div",fe,[t[30]||(t[30]=n("span",null,"Tax",-1)),n("span",null,p(w.value.tax.toFixed(2)),1)]),n("div",be,[t[31]||(t[31]=n("span",null,"Discount",-1)),n("span",null,p(w.value.discount.toFixed(2)),1)]),n("div",ve,[t[32]||(t[32]=n("span",null,"Estimated Total",-1)),n("span",null,p(w.value.total.toFixed(2)),1)])]),n("div",xe,[l(e(g),{type:"submit",disabled:e(i).processing||!u.value},{default:s(()=>[l(e(M),{class:"mr-2 h-4 w-4"}),r(" "+p(e(i).processing?"Saving...":"Save Changes"),1)]),_:1},8,["disabled"])])],32)]),_:1},8,["icon"])],64))}});export{et as default};
