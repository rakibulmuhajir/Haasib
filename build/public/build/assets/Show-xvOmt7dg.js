import{d as Q,q as R,s as b,c as u,a as s,u as n,h as Y,w as c,b as t,i as v,j as g,o as i,t as l,e as _,F as j,r as I,B,C,f as L}from"./app-B-wLZQl0.js";import{_ as Z}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as O}from"./index-D8JUok4n.js";import{_ as D}from"./index-a73qSWOM.js";import{_ as F,a as N}from"./CardContent.vue_vue_type_script_setup_true_lang-f-xi8uWj.js";import{_ as A}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cn7HWfaF.js";import{_ as M}from"./CardTitle.vue_vue_type_script_setup_true_lang-DXA8XANX.js";import{_ as q}from"./Checkbox.vue_vue_type_script_setup_true_lang-yNvHsWJi.js";import{_ as ee}from"./Progress.vue_vue_type_script_setup_true_lang-4d66u_3Y.js";import{A as te,a as ne}from"./arrow-up-right-riTe9r83.js";import{C as $}from"./circle-check-YKnAkXoj.js";import{C as X}from"./clock-9a58COAh.js";import{T as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import{C as z}from"./circle-x-BCtaKtUS.js";import{s as se}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import"./createLucideIcon-CbxkoCx6.js";import"./useForwardExpose-Ca12vFmR.js";import"./VisuallyHidden-BZkMfMV2.js";import"./nullish-CHIgUVhi.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./Collection-DN_gmv-a.js";import"./RovingFocusItem-PDr5bOed.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";import"./check-DogY6QNG.js";import"./loader-circle-BSwxCoSE.js";import"./info-_qQ0Rbsf.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./building-2-DLYGST8U.js";import"./plus-C63jdNg7.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./file-text-CFHWSPvd.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";const oe={class:"flex gap-2"},ie={class:"grid gap-6 lg:grid-cols-3"},le={class:"lg:col-span-2 space-y-6"},ce={class:"flex items-center justify-between mb-2"},re={class:"text-sm font-medium"},de={class:"mt-2 text-xs text-muted-foreground"},ue={key:0,class:"text-center py-6 text-muted-foreground"},me={key:1,class:"divide-y"},fe={class:"flex-1 min-w-0"},pe={class:"font-medium truncate"},_e={class:"flex items-center gap-2 text-xs text-muted-foreground"},ve={key:0},ye={key:1},ge={class:"font-mono text-green-600 font-medium"},he={key:0,class:"text-center py-6 text-muted-foreground"},be={key:1,class:"divide-y"},ke={class:"flex-1 min-w-0"},xe={class:"font-medium truncate"},we={class:"flex items-center gap-2 text-xs text-muted-foreground"},Ce={key:0},$e={key:1},Se={class:"font-mono text-red-600 font-medium"},Re={class:"space-y-6"},je={class:"pb-4 border-b"},Be={class:"font-medium"},De={class:"space-y-3"},Fe={class:"flex justify-between"},Ne={class:"font-mono"},Te={class:"flex justify-between text-green-600"},Pe={class:"font-mono"},Ue={class:"flex justify-between text-red-600"},Ae={class:"font-mono"},Me={class:"flex justify-between pt-2 border-t"},Ee={class:"font-mono font-medium"},Ve={class:"flex justify-between"},Ie={class:"font-mono"},Le={class:"flex items-center justify-between"},Oe={key:0,class:"text-sm text-green-600 mt-2 flex items-center gap-1"},qe={key:1,class:"text-sm text-red-600 mt-2 flex items-center gap-1"},Xe={class:"text-center text-sm text-muted-foreground"},Bt=Q({__name:"Show",props:{company:{},reconciliation:{},transactions:{},summary:{},canComplete:{type:Boolean}},setup(f){const r=f,J=[{title:"Dashboard",href:`/${r.company.slug}`},{title:"Banking",href:`/${r.company.slug}/banking/accounts`},{title:"Reconciliation",href:`/${r.company.slug}/banking/reconciliation`},{title:w(r.reconciliation.statement_date),href:"#"}],p=R([...r.transactions]),o=R({...r.summary}),S=R(r.canComplete),k=R(!1),x=b(()=>r.reconciliation.status==="in_progress"),K=b(()=>r.reconciliation.status==="completed"),T=b(()=>r.reconciliation.status==="cancelled");function y(d,e){return new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(d)}function w(d){return d?new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"—"}function h(d){return d.reconciliation_id===r.reconciliation.id}async function E(d){if(!x.value||k.value)return;k.value=!0;const e=p.value.findIndex(a=>a.id===d.id);if(e!==-1){const a=h(p.value[e]);p.value[e]={...p.value[e],reconciliation_id:a?null:r.reconciliation.id,is_reconciled:!a};const m=d.amount;a?(m>0?o.value.cleared_deposits-=m:o.value.cleared_withdrawals-=m,o.value.reconciled_balance-=m,o.value.uncleared_count++):(m>0?o.value.cleared_deposits+=m:o.value.cleared_withdrawals+=m,o.value.reconciled_balance+=m,o.value.uncleared_count--),o.value.difference=o.value.statement_ending_balance-o.value.reconciled_balance,S.value=Math.abs(o.value.difference)<.01}try{const m=await(await fetch(`/${r.company.slug}/banking/reconciliation/${r.reconciliation.id}/toggle`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({transaction_id:d.id})})).json();if(!m.success)throw new Error("Failed to toggle transaction");o.value.reconciled_balance=m.reconciled_balance,o.value.difference=m.difference,S.value=m.can_complete}catch{p.value=[...r.transactions],o.value={...r.summary},S.value=r.canComplete,C.error("Failed to update transaction")}finally{k.value=!1}}function W(){L.post(`/${r.company.slug}/banking/reconciliation/${r.reconciliation.id}/complete`,{},{onSuccess:()=>{C.success("Reconciliation completed successfully")},onError:()=>{C.error("Failed to complete reconciliation")}})}function G(){confirm("Cancel this reconciliation? This will unmark all cleared transactions.")&&H()}function H(){L.post(`/${r.company.slug}/banking/reconciliation/${r.reconciliation.id}/cancel`,{},{onSuccess:()=>{C.success("Reconciliation cancelled")},onError:()=>{C.error("Failed to cancel reconciliation")}})}const P=b(()=>p.value.filter(d=>d.amount>0)),U=b(()=>p.value.filter(d=>d.amount<0)),V=b(()=>{const d=p.value.length;if(d===0)return 100;const e=p.value.filter(a=>h(a)).length;return Math.round(e/d*100)});return(d,e)=>(i(),u(j,null,[s(n(Y),{title:`Reconciliation - ${w(f.reconciliation.statement_date)}`},null,8,["title"]),s(Z,{title:`Reconcile ${f.reconciliation.bank_account.account_name}`,breadcrumbs:J,icon:n(se)},{actions:c(()=>[t("div",oe,[x.value?(i(),u(j,{key:0},[s(n(O),{variant:"outline",onClick:G},{default:c(()=>[s(n(z),{class:"mr-2 h-4 w-4"}),e[0]||(e[0]=_(" Cancel ",-1))]),_:1}),s(n(O),{disabled:!S.value,onClick:W},{default:c(()=>[s(n($),{class:"mr-2 h-4 w-4"}),e[1]||(e[1]=_(" Finish Reconciliation ",-1))]),_:1},8,["disabled"])],64)):g("",!0),K.value?(i(),v(n(D),{key:1,variant:"secondary",class:"px-3 py-1"},{default:c(()=>[s(n($),{class:"mr-1 h-4 w-4"}),e[2]||(e[2]=_(" Completed ",-1))]),_:1})):g("",!0),T.value?(i(),v(n(D),{key:2,variant:"destructive",class:"px-3 py-1"},{default:c(()=>[s(n(z),{class:"mr-1 h-4 w-4"}),e[3]||(e[3]=_(" Cancelled ",-1))]),_:1})):g("",!0)])]),default:c(()=>[t("div",ie,[t("div",le,[x.value?(i(),v(n(F),{key:0},{default:c(()=>[s(n(N),{class:"pt-6"},{default:c(()=>[t("div",ce,[e[4]||(e[4]=t("span",{class:"text-sm text-muted-foreground"},"Progress",-1)),t("span",re,l(V.value)+"%",1)]),s(n(ee),{"model-value":V.value,class:"h-2"},null,8,["model-value"]),t("p",de,l(p.value.filter(a=>h(a)).length)+" of "+l(p.value.length)+" transactions cleared ",1)]),_:1})]),_:1})):g("",!0),s(n(F),null,{default:c(()=>[s(n(A),null,{default:c(()=>[s(n(M),{class:"flex items-center gap-2"},{default:c(()=>[s(n(te),{class:"h-5 w-5 text-green-600"}),e[5]||(e[5]=_(" Deposits & Credits ",-1)),s(n(D),{variant:"outline",class:"ml-auto"},{default:c(()=>[_(l(P.value.length),1)]),_:1})]),_:1})]),_:1}),s(n(N),null,{default:c(()=>[P.value.length===0?(i(),u("div",ue," No deposits in this period ")):(i(),u("div",me,[(i(!0),u(j,null,I(P.value,a=>(i(),u("div",{key:a.id,class:B(["flex items-center gap-4 py-3",{"opacity-50":T.value}])},[x.value?(i(),v(n(q),{key:0,checked:h(a),disabled:k.value,"onUpdate:checked":m=>E(a)},null,8,["checked","disabled","onUpdate:checked"])):h(a)?(i(),v(n($),{key:1,class:"h-5 w-5 text-green-600"})):(i(),v(n(X),{key:2,class:"h-5 w-5 text-muted-foreground"})),t("div",fe,[t("p",pe,l(a.description),1),t("div",_e,[t("span",null,l(w(a.transaction_date)),1),a.payee_name?(i(),u("span",ve,"• "+l(a.payee_name),1)):g("",!0),a.reference_number?(i(),u("span",ye,"• #"+l(a.reference_number),1)):g("",!0)])]),t("span",ge," +"+l(y(a.amount,f.reconciliation.bank_account.currency)),1)],2))),128))]))]),_:1})]),_:1}),s(n(F),null,{default:c(()=>[s(n(A),null,{default:c(()=>[s(n(M),{class:"flex items-center gap-2"},{default:c(()=>[s(n(ne),{class:"h-5 w-5 text-red-600"}),e[6]||(e[6]=_(" Payments & Withdrawals ",-1)),s(n(D),{variant:"outline",class:"ml-auto"},{default:c(()=>[_(l(U.value.length),1)]),_:1})]),_:1})]),_:1}),s(n(N),null,{default:c(()=>[U.value.length===0?(i(),u("div",he," No withdrawals in this period ")):(i(),u("div",be,[(i(!0),u(j,null,I(U.value,a=>(i(),u("div",{key:a.id,class:B(["flex items-center gap-4 py-3",{"opacity-50":T.value}])},[x.value?(i(),v(n(q),{key:0,checked:h(a),disabled:k.value,"onUpdate:checked":m=>E(a)},null,8,["checked","disabled","onUpdate:checked"])):h(a)?(i(),v(n($),{key:1,class:"h-5 w-5 text-green-600"})):(i(),v(n(X),{key:2,class:"h-5 w-5 text-muted-foreground"})),t("div",ke,[t("p",xe,l(a.description),1),t("div",we,[t("span",null,l(w(a.transaction_date)),1),a.payee_name?(i(),u("span",Ce,"• "+l(a.payee_name),1)):g("",!0),a.reference_number?(i(),u("span",$e,"• #"+l(a.reference_number),1)):g("",!0)])]),t("span",Se,l(y(a.amount,f.reconciliation.bank_account.currency)),1)],2))),128))]))]),_:1})]),_:1})]),t("div",Re,[s(n(F),{class:"sticky top-6"},{default:c(()=>[s(n(A),null,{default:c(()=>[s(n(M),null,{default:c(()=>[...e[7]||(e[7]=[_("Reconciliation Summary",-1)])]),_:1})]),_:1}),s(n(N),{class:"space-y-4"},{default:c(()=>[t("div",je,[e[8]||(e[8]=t("p",{class:"text-sm text-muted-foreground"},"Statement Date",-1)),t("p",Be,l(w(f.reconciliation.statement_date)),1)]),t("div",De,[t("div",Fe,[e[9]||(e[9]=t("span",{class:"text-sm text-muted-foreground"},"Starting Balance",-1)),t("span",Ne,l(y(o.value.starting_balance,f.reconciliation.bank_account.currency)),1)]),t("div",Te,[e[10]||(e[10]=t("span",{class:"text-sm"},"+ Cleared Deposits",-1)),t("span",Pe,l(y(o.value.cleared_deposits,f.reconciliation.bank_account.currency)),1)]),t("div",Ue,[e[11]||(e[11]=t("span",{class:"text-sm"},"- Cleared Payments",-1)),t("span",Ae,l(y(Math.abs(o.value.cleared_withdrawals),f.reconciliation.bank_account.currency)),1)]),t("div",Me,[e[12]||(e[12]=t("span",{class:"text-sm font-medium"},"Reconciled Balance",-1)),t("span",Ee,l(y(o.value.reconciled_balance,f.reconciliation.bank_account.currency)),1)]),t("div",Ve,[e[13]||(e[13]=t("span",{class:"text-sm text-muted-foreground"},"Statement Balance",-1)),t("span",Ie,l(y(o.value.statement_ending_balance,f.reconciliation.bank_account.currency)),1)])]),t("div",{class:B(["p-4 rounded-lg",Math.abs(o.value.difference)<.01?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"])},[t("div",Le,[e[14]||(e[14]=t("span",{class:"font-medium"},"Difference",-1)),t("span",{class:B(["font-mono text-lg font-bold",Math.abs(o.value.difference)<.01?"text-green-600":"text-red-600"])},l(y(o.value.difference,f.reconciliation.bank_account.currency)),3)]),Math.abs(o.value.difference)<.01?(i(),u("p",Oe,[s(n($),{class:"h-4 w-4"}),e[15]||(e[15]=_(" Ready to finish! ",-1))])):(i(),u("p",qe,[s(n(ae),{class:"h-4 w-4"}),e[16]||(e[16]=_(" Clear more transactions to balance ",-1))]))],2),t("div",Xe,l(o.value.uncleared_count)+" transaction"+l(o.value.uncleared_count!==1?"s":"")+" still uncleared ",1)]),_:1})]),_:1})])])]),_:1},8,["title","icon"])],64))}});export{Bt as default};
