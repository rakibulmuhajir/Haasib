import{d as ae,x as le,q,s as y,c as f,a as l,u as t,h as se,w as n,j as B,i as V,o as c,B as w,t as m,e as u,b as s,F as O,r as ie}from"./app-B-wLZQl0.js";import{_ as ne}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as v}from"./index-D8JUok4n.js";import{_ as oe}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_ as re}from"./index-a73qSWOM.js";import{_ as R}from"./Progress.vue_vue_type_script_setup_true_lang-4d66u_3Y.js";import{_ as de,a as ue}from"./index-BLvrLCqs.js";import{_ as M,a as D}from"./CardContent.vue_vue_type_script_setup_true_lang-f-xi8uWj.js";import{_ as F}from"./CardDescription.vue_vue_type_script_setup_true_lang-D23jLuEj.js";import{_ as z}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cn7HWfaF.js";import{_ as E}from"./CardTitle.vue_vue_type_script_setup_true_lang-DXA8XANX.js";import{z as j,F as me}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import{c as Z}from"./createLucideIcon-CbxkoCx6.js";import{C as I}from"./calculator-6dvreMiC.js";import{T as ce}from"./trending-up-a1ZqhVfb.js";import{F as pe}from"./file-text-CFHWSPvd.js";import{C as fe}from"./circle-check-YKnAkXoj.js";import{C as ve}from"./circle-alert-BYvWrmbz.js";import{A as xe}from"./arrow-left-DSX0n2_N.js";import{S as ge}from"./save-CBmuHaqJ.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./loader-circle-BSwxCoSE.js";import"./info-_qQ0Rbsf.js";import"./useForwardExpose-Ca12vFmR.js";import"./VisuallyHidden-BZkMfMV2.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./Collection-DN_gmv-a.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./plus-C63jdNg7.js";import"./check-DogY6QNG.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=Z("RotateCcwIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=Z("ZapIcon",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),be={class:"grid gap-6 md:grid-cols-3"},he={class:"text-2xl font-bold text-blue-600"},we={class:"mt-6 space-y-2"},Ce={class:"flex justify-between text-sm"},Ae={class:"mt-4"},ke={class:"flex items-center gap-2"},$e={class:"text-sm font-medium"},Be={class:"flex flex-wrap gap-3"},Te={key:0,class:"text-center py-8 text-muted-foreground"},Se={key:1,class:"space-y-4"},Me={class:"flex items-start justify-between gap-4"},De={class:"flex-1"},Fe={class:"flex items-center gap-3 mb-2"},ze={class:"font-semibold text-lg"},Ee={class:"text-sm text-muted-foreground"},Ne={key:0,class:"ml-2 text-xs font-medium px-2 py-1 rounded-full bg-orange-100 text-orange-800"},Le={class:"flex items-center gap-4"},Pe={class:"flex-1"},Ue={class:"flex items-center gap-3"},qe={class:"flex-1 max-w-xs"},Ve={class:"text-sm text-muted-foreground"},Oe={class:"flex gap-2"},Re={key:3,class:"mt-6 text-center py-8 text-muted-foreground"},Tt=ae({__name:"Apply",props:{company:{},credit:{},unpaidBills:{}},setup(d){const r=d,Q=[{title:"Dashboard",href:`/${r.company.slug}`},{title:"Vendor Credits",href:`/${r.company.slug}/vendor-credits`},{title:r.credit.credit_number,href:`/${r.company.slug}/vendor-credits/${r.credit.id}`},{title:"Apply",href:`/${r.company.slug}/vendor-credits/${r.credit.id}/apply`}],_=le({applications:r.unpaidBills.map(i=>({bill_id:i.id,amount_applied:0}))}),p=q(!1),C=q(""),b=y(()=>_.applications.reduce((i,e)=>i+(Number(e.amount_applied)||0),0)),h=y(()=>r.credit.amount-b.value),N=y(()=>b.value/r.credit.amount*100),x=y(()=>b.value>r.credit.amount),L=y(()=>h.value>.001),T=y(()=>b.value>0),g=y(()=>T.value?x.value?"exceeded":L.value?"partial":"perfect":"empty"),A=(i,e)=>new Intl.NumberFormat("en-US",{style:"currency",currency:e||"USD"}).format(i),G=i=>i?new Date(i).toLocaleDateString():"â€”",k=(i,e)=>{const a=Math.min(e,r.unpaidBills.find(o=>o.id===i)?.balance||0);_.applications.find(o=>o.bill_id===i).amount_applied=a},$=i=>_.applications.find(e=>e.bill_id===i)?.amount_applied??0,H=i=>{const e=r.unpaidBills.find(a=>a.id===i);e&&k(i,e.balance)},J=i=>{const e=r.unpaidBills.find(a=>a.id===i);if(e){const a=Math.min(e.balance,h.value);k(i,a)}},K=()=>{const i=[...r.unpaidBills].sort((a,o)=>{const ee=a.due_date?new Date(a.due_date).getTime():0,te=o.due_date?new Date(o.due_date).getTime():0;return ee-te});let e=h.value;i.forEach(a=>{if(e>0){const o=Math.min(a.balance,e);k(a.id,o),e-=o}})},W=()=>{const i=[...r.unpaidBills].sort((a,o)=>o.balance-a.balance);let e=h.value;i.forEach(a=>{if(e>0){const o=Math.min(a.balance,e);k(a.id,o),e-=o}})},X=()=>{_.applications.forEach(i=>{i.amount_applied=0})},P=()=>{W()},Y=()=>{if(!T.value){C.value="Please enter an amount to apply",p.value=!0,setTimeout(()=>p.value=!1,3e3);return}if(x.value){C.value="Applications exceed credit amount",p.value=!0,setTimeout(()=>p.value=!1,3e3);return}_.post(`/${r.company.slug}/vendor-credits/${r.credit.id}/apply`,{preserveScroll:!0,onSuccess:()=>{C.value="Credit applied successfully!",p.value=!0,setTimeout(()=>{p.value=!1,window.location.href=`/${r.company.slug}/vendor-credits/${r.credit.id}`},1500)},onError:i=>{C.value="Error applying credit",p.value=!0,setTimeout(()=>p.value=!1,3e3)}})},S=(i,e)=>e>=i.balance?"fully-paid":e>0?"partially-paid":"unpaid",U=i=>{if(!i)return null;const e=new Date,a=new Date(i),o=Math.floor((e.getTime()-a.getTime())/(1e3*60*60*24));return o>0?o:null};return(i,e)=>(c(),f(O,null,[l(t(se),{title:`Apply ${d.credit.credit_number}`},null,8,["title"]),l(ne,{title:`Apply ${d.credit.credit_number}`,breadcrumbs:Q,icon:t(me)},{actions:n(()=>[l(t(v),{variant:"outline",onClick:e[0]||(e[0]=a=>i.router.get(`/${d.company.slug}/vendor-credits/${d.credit.id}`))},{default:n(()=>[l(t(xe),{class:"mr-2 h-4 w-4"}),e[1]||(e[1]=u(" Back to Credit ",-1))]),_:1}),l(t(v),{onClick:Y,disabled:t(_).processing||!T.value||x.value},{default:n(()=>[l(t(ge),{class:"mr-2 h-4 w-4"}),e[2]||(e[2]=u(" Apply Credit ",-1))]),_:1},8,["disabled"])]),default:n(()=>[p.value?(c(),f("div",{key:0,class:w(["fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg transition-all duration-300",g.value==="exceeded"?"bg-red-500 text-white":"bg-green-500 text-white"])},m(C.value),3)):B("",!0),l(t(M),{class:"mb-6"},{default:n(()=>[l(t(z),null,{default:n(()=>[l(t(E),{class:"flex items-center gap-2"},{default:n(()=>[l(t(j),{class:"h-5 w-5"}),e[3]||(e[3]=u(" Credit Summary ",-1))]),_:1}),l(t(F),null,{default:n(()=>[u(" Apply credit to unpaid bills from "+m(d.credit.vendor?.name||"vendor"),1)]),_:1})]),_:1}),l(t(D),null,{default:n(()=>[s("div",be,[s("div",null,[e[4]||(e[4]=s("div",{class:"text-sm font-medium text-muted-foreground"},"Available Credit",-1)),s("div",he,m(A(d.credit.amount,d.credit.currency)),1)]),s("div",null,[e[5]||(e[5]=s("div",{class:"text-sm font-medium text-muted-foreground"},"Applied Amount",-1)),s("div",{class:w(["text-2xl font-bold",x.value?"text-red-600":"text-green-600"])},m(A(b.value,d.credit.currency)),3)]),s("div",null,[e[6]||(e[6]=s("div",{class:"text-sm font-medium text-muted-foreground"},"Remaining",-1)),s("div",{class:w(["text-2xl font-bold",L.value?"text-orange-600":"text-gray-600"])},m(A(Math.max(0,h.value),d.credit.currency)),3)])]),s("div",we,[s("div",Ce,[e[7]||(e[7]=s("span",null,"Credit Utilization",-1)),s("span",{class:w(x.value?"text-red-600 font-semibold":"text-muted-foreground")},m(N.value.toFixed(1))+"% ",3)]),l(t(R),{value:Math.min(100,N.value),class:w(x.value?"bg-red-100":"")},null,8,["value","class"])]),s("div",Ae,[s("div",ke,[s("div",{class:w(["w-3 h-3 rounded-full",g.value==="perfect"?"bg-green-500":g.value==="partial"?"bg-orange-500":g.value==="exceeded"?"bg-red-500":"bg-gray-500"])},null,2),s("span",$e,m(g.value==="perfect"?"Perfect match!":g.value==="partial"?"Credit remaining":g.value==="exceeded"?"Exceeded credit amount":"No applications yet"),1)])])]),_:1})]),_:1}),d.unpaidBills.length>0?(c(),V(t(M),{key:1,class:"mb-6"},{default:n(()=>[l(t(z),null,{default:n(()=>[l(t(E),{class:"flex items-center gap-2"},{default:n(()=>[l(t(_e),{class:"h-5 w-5"}),e[8]||(e[8]=u(" Quick Actions ",-1))]),_:1}),l(t(F),null,{default:n(()=>[...e[9]||(e[9]=[u(" Smart tools to quickly apply your credit ",-1)])]),_:1})]),_:1}),l(t(D),null,{default:n(()=>[s("div",Be,[l(t(v),{variant:"outline",onClick:P,class:"flex items-center gap-2"},{default:n(()=>[l(t(I),{class:"h-4 w-4"}),e[10]||(e[10]=u(" Optimize (Largest Bills) ",-1))]),_:1}),l(t(v),{variant:"outline",onClick:K,class:"flex items-center gap-2"},{default:n(()=>[l(t(ce),{class:"h-4 w-4"}),e[11]||(e[11]=u(" Apply to Oldest ",-1))]),_:1}),l(t(v),{variant:"outline",onClick:X,class:"flex items-center gap-2"},{default:n(()=>[l(t(ye),{class:"h-4 w-4"}),e[12]||(e[12]=u(" Clear All ",-1))]),_:1})])]),_:1})]),_:1})):B("",!0),l(t(M),null,{default:n(()=>[l(t(z),null,{default:n(()=>[l(t(E),{class:"flex items-center gap-2"},{default:n(()=>[l(t(pe),{class:"h-5 w-5"}),u(" Unpaid Bills ("+m(d.unpaidBills.length)+") ",1)]),_:1}),l(t(F),null,{default:n(()=>[...e[13]||(e[13]=[u(" Select bills and amounts to apply your credit ",-1)])]),_:1})]),_:1}),l(t(D),null,{default:n(()=>[d.unpaidBills.length===0?(c(),f("div",Te,[l(t(fe),{class:"h-12 w-12 mx-auto mb-4 text-green-500"}),e[14]||(e[14]=s("div",{class:"text-lg font-medium"},"No unpaid bills",-1)),e[15]||(e[15]=s("div",{class:"text-sm"},"All bills have been paid or no bills are associated with this vendor",-1))])):(c(),f("div",Se,[(c(!0),f(O,null,ie(d.unpaidBills,a=>(c(),f("div",{key:a.id,class:"rounded-lg border p-4 transition-all hover:border-primary/50"},[s("div",Me,[s("div",De,[s("div",Fe,[s("div",null,[s("div",ze,m(a.bill_number),1),s("div",Ee,[u(" Due: "+m(G(a.due_date))+" ",1),U(a.due_date)?(c(),f("span",Ne,m(U(a.due_date))+" days overdue ",1)):B("",!0)])]),l(t(re),{variant:S(a,$(a.id))==="fully-paid"?"success":S(a,$(a.id))==="partially-paid"?"warning":"secondary"},{default:n(()=>[u(m(S(a,$(a.id))?.replace("-"," ").toUpperCase()),1)]),_:2},1032,["variant"])]),s("div",Le,[s("div",Pe,[s("div",Ue,[s("div",qe,[e[16]||(e[16]=s("label",{class:"text-xs font-medium text-muted-foreground"},"Amount to Apply",-1)),l(t(oe),{type:"number",min:"0",step:"0.01",max:a.balance,value:$(a.id),onInput:o=>k(a.id,parseFloat(o.target.value)||0),class:"font-mono"},null,8,["max","value","onInput"])]),s("div",Ve,[s("div",null,"of "+m(A(a.balance,a.currency)),1),l(t(R),{value:$(a.id)/a.balance*100,class:"w-24 h-2 mt-1"},null,8,["value"])])])]),s("div",Oe,[l(t(v),{size:"sm",variant:"outline",onClick:o=>J(a.id),disabled:h.value<=0},{default:n(()=>[...e[17]||(e[17]=[u(" Max Possible ",-1)])]),_:1},8,["onClick","disabled"]),l(t(v),{size:"sm",variant:"outline",onClick:o=>H(a.id)},{default:n(()=>[...e[18]||(e[18]=[u(" Full Amount ",-1)])]),_:1},8,["onClick"])])])])])]))),128))]))]),_:1})]),_:1}),x.value?(c(),V(t(de),{key:2,class:"mt-6 border-red-200 bg-red-50"},{default:n(()=>[l(t(ve),{class:"h-4 w-4 text-red-600"}),l(t(ue),{class:"text-red-800"},{default:n(()=>[u(" Total applications exceed the available credit amount by "+m(A(b.value-d.credit.amount,d.credit.currency))+". Please reduce the amounts to continue. ",1)]),_:1})]),_:1})):B("",!0),!T.value&&d.unpaidBills.length>0?(c(),f("div",Re,[l(t(j),{class:"h-12 w-12 mx-auto mb-4 opacity-50"}),e[20]||(e[20]=s("div",{class:"text-lg font-medium"},"No applications yet",-1)),e[21]||(e[21]=s("div",{class:"text-sm mb-4"},"Enter amounts or use quick actions to apply your credit",-1)),l(t(v),{onClick:P,variant:"outline"},{default:n(()=>[l(t(I),{class:"mr-2 h-4 w-4"}),e[19]||(e[19]=u(" Smart Apply ",-1))]),_:1})])):B("",!0)]),_:1},8,["title","icon"])],64))}});export{Tt as default};
