import{d as B,x as I,s as P,c as v,a as o,u as t,h as R,w as r,b as d,y as z,e as u,o as p,F as x,r as g,i as w,t as c,j as O,B as Q,f as F}from"./app-B-wLZQl0.js";import{_ as G}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as N}from"./index-D8JUok4n.js";import{_ as i}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_ as a}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{_ as q,a as C,b as S,c as $,d as y}from"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import{u as H}from"./useFormFeedback-CE35LO4q.js";import{P as J}from"./plus-C63jdNg7.js";import{T as K}from"./trash-2-BxVbfljz.js";import{S as W}from"./save-CBmuHaqJ.js";import{F as X}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./loader-circle-BSwxCoSE.js";import"./createLucideIcon-CbxkoCx6.js";import"./info-_qQ0Rbsf.js";import"./circle-check-YKnAkXoj.js";import"./useForwardExpose-Ca12vFmR.js";import"./index-a73qSWOM.js";import"./VisuallyHidden-BZkMfMV2.js";import"./Collection-DN_gmv-a.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./check-DogY6QNG.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./file-text-CFHWSPvd.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";const Y={class:"grid gap-4 md:grid-cols-2"},Z={class:"md:col-span-2"},h={class:"space-y-3"},ee={class:"flex items-center justify-between"},te={class:"space-y-4"},ne={class:"md:col-span-2"},oe={key:0,class:"text-xs text-red-500 mt-1"},le={class:"md:col-span-2"},de={class:"flex items-end justify-between gap-2"},re={class:"grid gap-2 md:w-1/2"},se={class:"flex justify-between text-sm"},ue={class:"flex justify-between text-sm"},ae={class:"flex justify-between text-sm"},ie={class:"flex justify-between text-base font-semibold"},me={class:"flex justify-end gap-3"},He=B({__name:"Create",props:{company:{},vendors:{},expenseAccounts:{},apAccounts:{}},setup(k){const _=k,T=[{title:"Dashboard",href:`/${_.company.slug}`},{title:"Vendor Credits",href:`/${_.company.slug}/vendor-credits`},{title:"Create",href:`/${_.company.slug}/vendor-credits/create`}],{showSuccess:j,showError:A}=H(),D=()=>({description:"",quantity:1,unit_price:0,tax_rate:0,discount_rate:0,expense_account_id:""}),l=I({vendor_id:"",bill_id:"",credit_date:new Date().toISOString().slice(0,10),amount:0,currency:_.company.base_currency,base_currency:_.company.base_currency,exchange_rate:"",reason:"",notes:"",ap_account_id:"",status:"received",line_items:[D()]}),V=P(()=>{const f=l.line_items.reduce((s,m)=>s+(Number(m.quantity)||0)*(Number(m.unit_price)||0),0),e=l.line_items.reduce((s,m)=>{const U=(Number(m.quantity)||0)*(Number(m.unit_price)||0);return s+U*((Number(m.tax_rate)||0)/100)},0),n=l.line_items.reduce((s,m)=>{const U=(Number(m.quantity)||0)*(Number(m.unit_price)||0);return s+U*((Number(m.discount_rate)||0)/100)},0),b=f+e-n;return{subtotal:f,tax:e,discount:n,total:b}}),E=()=>l.line_items.push(D()),L=f=>{l.line_items.length>1&&l.line_items.splice(f,1)},M=()=>{if(!l.amount||l.amount<=0){A("Amount must be greater than zero");return}const f=l.line_items.filter(n=>{const b=n.description&&n.description.trim()!=="";return n.quantity&&Number(n.quantity)>0,n.unit_price&&Number(n.unit_price)>=0,b}),e={vendor_id:l.vendor_id==="__none"?null:l.vendor_id,bill_id:l.bill_id||null,credit_date:l.credit_date,amount:l.amount,currency:l.currency,base_currency:l.base_currency,exchange_rate:l.exchange_rate||null,reason:l.reason,notes:l.notes||null,ap_account_id:l.ap_account_id==="__none"?null:l.ap_account_id||null,status:l.status};f.length>0&&(e.line_items=f.map(n=>({description:n.description.trim(),quantity:Number(n.quantity)||1,unit_price:Number(n.unit_price)||0,tax_rate:Number(n.tax_rate)||0,discount_rate:Number(n.discount_rate)||0,expense_account_id:n.expense_account_id==="__none"?null:n.expense_account_id||null}))),F.post(`/${_.company.slug}/vendor-credits`,e,{preserveScroll:!0,onStart:()=>{l.processing=!0},onFinish:()=>{l.processing=!1},onSuccess:()=>{j("Vendor credit created successfully"),F.visit(`/${_.company.slug}/vendor-credits`)},onError:n=>{console.error("Validation errors:",n),A(n),l.errors=n}})};return(f,e)=>(p(),v(x,null,[o(t(R),{title:"Create Vendor Credit"}),o(G,{title:"Create Vendor Credit",breadcrumbs:T,icon:t(X)},{default:r(()=>[d("form",{class:"space-y-6",onSubmit:z(M,["prevent"])},[d("div",Y,[d("div",null,[o(t(a),{for:"vendor_id"},{default:r(()=>[...e[8]||(e[8]=[u("Vendor",-1)])]),_:1}),o(t(q),{modelValue:t(l).vendor_id,"onUpdate:modelValue":e[0]||(e[0]=n=>t(l).vendor_id=n),required:""},{default:r(()=>[o(t(C),{id:"vendor_id"},{default:r(()=>[o(t(S),{placeholder:"Select vendor"})]),_:1}),o(t($),null,{default:r(()=>[o(t(y),{value:"__none"},{default:r(()=>[...e[9]||(e[9]=[u("Select vendor",-1)])]),_:1}),(p(!0),v(x,null,g(k.vendors,n=>(p(),w(t(y),{key:n.id,value:n.id},{default:r(()=>[u(c(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),d("div",null,[o(t(a),{for:"credit_date"},{default:r(()=>[...e[10]||(e[10]=[u("Credit Date",-1)])]),_:1}),o(t(i),{id:"credit_date",modelValue:t(l).credit_date,"onUpdate:modelValue":e[1]||(e[1]=n=>t(l).credit_date=n),type:"date",required:""},null,8,["modelValue"])]),d("div",null,[o(t(a),{for:"amount"},{default:r(()=>[...e[11]||(e[11]=[u("Amount",-1)])]),_:1}),o(t(i),{id:"amount",modelValue:t(l).amount,"onUpdate:modelValue":e[2]||(e[2]=n=>t(l).amount=n),modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",required:""},null,8,["modelValue"])]),d("div",null,[o(t(a),{for:"currency"},{default:r(()=>[...e[12]||(e[12]=[u("Currency",-1)])]),_:1}),o(t(i),{id:"currency",modelValue:t(l).currency,"onUpdate:modelValue":e[3]||(e[3]=n=>t(l).currency=n),maxlength:"3"},null,8,["modelValue"])]),d("div",null,[o(t(a),{for:"exchange_rate"},{default:r(()=>[...e[13]||(e[13]=[u("Exchange Rate",-1)])]),_:1}),o(t(i),{id:"exchange_rate",modelValue:t(l).exchange_rate,"onUpdate:modelValue":e[4]||(e[4]=n=>t(l).exchange_rate=n),placeholder:"Required if currency != base"},null,8,["modelValue"])]),d("div",null,[o(t(a),{for:"reason"},{default:r(()=>[...e[14]||(e[14]=[u("Reason",-1)])]),_:1}),o(t(i),{id:"reason",modelValue:t(l).reason,"onUpdate:modelValue":e[5]||(e[5]=n=>t(l).reason=n),required:""},null,8,["modelValue"])]),d("div",null,[o(t(a),{for:"ap_account_id"},{default:r(()=>[...e[15]||(e[15]=[u("AP Account",-1)])]),_:1}),o(t(q),{modelValue:t(l).ap_account_id,"onUpdate:modelValue":e[6]||(e[6]=n=>t(l).ap_account_id=n)},{default:r(()=>[o(t(C),{id:"ap_account_id"},{default:r(()=>[o(t(S),{placeholder:"Default AP"})]),_:1}),o(t($),null,{default:r(()=>[o(t(y),{value:"__none"},{default:r(()=>[...e[16]||(e[16]=[u("Use vendor default",-1)])]),_:1}),(p(!0),v(x,null,g(_.apAccounts,n=>(p(),w(t(y),{key:n.id,value:n.id},{default:r(()=>[u(c(n.code)+" — "+c(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),d("div",Z,[o(t(a),{for:"notes"},{default:r(()=>[...e[17]||(e[17]=[u("Notes",-1)])]),_:1}),o(t(i),{id:"notes",modelValue:t(l).notes,"onUpdate:modelValue":e[7]||(e[7]=n=>t(l).notes=n)},null,8,["modelValue"])])]),d("div",h,[d("div",ee,[e[19]||(e[19]=d("div",{class:"text-lg font-semibold"},"Line Items (optional)",-1)),o(t(N),{type:"button",variant:"outline",onClick:E},{default:r(()=>[o(t(J),{class:"mr-2 h-4 w-4"}),e[18]||(e[18]=u(" Add Line ",-1))]),_:1})]),e[27]||(e[27]=d("p",{class:"text-sm text-muted-foreground"}," Add line items for detailed tracking. Items without descriptions will be excluded. ",-1)),d("div",te,[(p(!0),v(x,null,g(t(l).line_items,(n,b)=>(p(),v("div",{key:b,class:"grid gap-3 rounded border p-3 md:grid-cols-5"},[d("div",ne,[o(t(a),null,{default:r(()=>[...e[20]||(e[20]=[u("Description ",-1),d("span",{class:"text-red-500"},"*",-1)])]),_:1}),o(t(i),{modelValue:n.description,"onUpdate:modelValue":s=>n.description=s,class:Q({"border-red-300":!n.description||n.description.trim()===""}),placeholder:"Required for line item to be included"},null,8,["modelValue","onUpdate:modelValue","class"]),!n.description||n.description.trim()===""?(p(),v("p",oe," Description required - item will be excluded ")):O("",!0)]),d("div",null,[o(t(a),null,{default:r(()=>[...e[21]||(e[21]=[u("Qty",-1)])]),_:1}),o(t(i),{modelValue:n.quantity,"onUpdate:modelValue":s=>n.quantity=s,modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",null,[o(t(a),null,{default:r(()=>[...e[22]||(e[22]=[u("Unit Price",-1)])]),_:1}),o(t(i),{modelValue:n.unit_price,"onUpdate:modelValue":s=>n.unit_price=s,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",le,[o(t(a),null,{default:r(()=>[...e[23]||(e[23]=[u("Expense Account",-1)])]),_:1}),o(t(q),{modelValue:n.expense_account_id,"onUpdate:modelValue":s=>n.expense_account_id=s},{default:r(()=>[o(t(C),null,{default:r(()=>[o(t(S),{placeholder:"Select account"})]),_:1}),o(t($),null,{default:r(()=>[o(t(y),{value:"__none"},{default:r(()=>[...e[24]||(e[24]=[u("Default",-1)])]),_:1}),(p(!0),v(x,null,g(_.expenseAccounts,s=>(p(),w(t(y),{key:s.id,value:s.id},{default:r(()=>[u(c(s.code)+" — "+c(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),d("div",de,[o(t(N),{type:"button",variant:"destructive",size:"icon",onClick:s=>L(b)},{default:r(()=>[o(t(K),{class:"h-4 w-4"})]),_:1},8,["onClick"])]),d("div",null,[o(t(a),null,{default:r(()=>[...e[25]||(e[25]=[u("Tax %",-1)])]),_:1}),o(t(i),{modelValue:n.tax_rate,"onUpdate:modelValue":s=>n.tax_rate=s,modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",null,[o(t(a),null,{default:r(()=>[...e[26]||(e[26]=[u("Discount %",-1)])]),_:1}),o(t(i),{modelValue:n.discount_rate,"onUpdate:modelValue":s=>n.discount_rate=s,modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),d("div",re,[d("div",se,[e[28]||(e[28]=d("span",null,"Subtotal",-1)),d("span",null,c(V.value.subtotal.toFixed(2)),1)]),d("div",ue,[e[29]||(e[29]=d("span",null,"Tax",-1)),d("span",null,c(V.value.tax.toFixed(2)),1)]),d("div",ae,[e[30]||(e[30]=d("span",null,"Discount",-1)),d("span",null,c(V.value.discount.toFixed(2)),1)]),d("div",ie,[e[31]||(e[31]=d("span",null,"Estimated Total",-1)),d("span",null,c(V.value.total.toFixed(2)),1)])]),d("div",me,[o(t(N),{type:"submit",disabled:t(l).processing},{default:r(()=>[o(t(W),{class:"mr-2 h-4 w-4"}),u(" "+c(t(l).processing?"Saving...":"Save Credit"),1)]),_:1},8,["disabled"])])],32)]),_:1},8,["icon"])],64))}});export{He as default};
