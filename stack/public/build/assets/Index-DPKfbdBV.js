import{j as Y,q as G,r as v,k,s as Q,x as W,y as ee,c as te,o as g,d as t,a as o,m as b,i as w,e,w as r,l as $,t as y,z as ae,b as V,h as F}from"./app-DjFlEUH4.js";import{s as p,b as P,a as A}from"./index-DL9KtRp0.js";import{s as se,a as m}from"./index-DgqSODAa.js";import{s as L}from"./index-Cl6iUony.js";import{s as le,a as oe,b as re}from"./index-zYy9pXTp.js";import{s as ie}from"./index-CXOcYUhh.js";import{s as N}from"./index-424M1LzA.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CyPBiJ0T.js";import"./index-CyCOy2Ll.js";import"./index-Dp6GxYCd.js";import"./index-CpMPr0UE.js";const ce={class:"companies-index"},ue={class:"flex justify-between items-center mb-6"},de={class:"flex gap-2"},pe={class:"flex items-center justify-between"},me={class:"flex items-center gap-3"},ve={class:"font-semibold text-lg"},ye={class:"text-gray-600 dark:text-gray-400"},fe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ge={class:"flex gap-2 mt-4"},he={class:"flex items-center gap-3"},_e={class:"font-semibold"},be={class:"text-sm text-gray-500 dark:text-gray-400"},we={class:"flex gap-2"},xe={class:"text-center py-8"},Ce={__name:"Index",setup(ke){const{t:Se}=Y(),S=G(),f=v(),x=v(!1),O=v([]),R=v(0),u=v({search:"",industry:null,country:null,is_active:null,currency:null}),h=v({field:"name",direction:"asc"}),i=v({page:1,per_page:15}),j=k(()=>S.props.auth?.user),n=k(()=>S.props.currentCompany),z=k(()=>S.props.userCompanies||[]),E=k(()=>j.value?.system_role==="system_owner"||z.value.some(a=>a.userRole==="owner")),I=[{label:"Hospitality",value:"hospitality"},{label:"Retail",value:"retail"},{label:"Professional Services",value:"professional_services"},{label:"Technology",value:"technology"},{label:"Healthcare",value:"healthcare"},{label:"Education",value:"education"},{label:"Manufacturing",value:"manufacturing"},{label:"Other",value:"other"}],D=[{label:"Active",value:!0},{label:"Inactive",value:!1}],B=[{label:"Name (A-Z)",value:{field:"name",direction:"asc"}},{label:"Name (Z-A)",value:{field:"name",direction:"desc"}},{label:"Created (Newest)",value:{field:"created_at",direction:"desc"}},{label:"Created (Oldest)",value:{field:"created_at",direction:"asc"}},{label:"Industry",value:{field:"industry",direction:"asc"}}],d=async()=>{x.value=!0;try{const a=new URLSearchParams({page:i.value.page,per_page:i.value.per_page,sort:h.value.field,direction:h.value.direction,...Object.fromEntries(Object.entries(u.value).filter(([s,C])=>C!==null&&C!==""))}),l=await fetch(`/api/v1/companies?${a}`),c=await l.json();if(l.ok)O.value=c.data||[],R.value=c.meta?.total||0;else throw new Error(c.message||"Failed to load companies")}catch(a){console.error("Failed to load companies:",a),f.value.add({severity:"error",summary:"Error",detail:a.message,life:3e3})}finally{x.value=!1}},U=()=>{d()},_=()=>{i.value.page=1,d()},K=()=>{u.value={search:"",industry:null,country:null,is_active:null,currency:null},i.value.page=1,d()},q=a=>{h.value={field:a.sortField,direction:a.sortOrder===1?"desc":"asc"},d()},H=a=>{i.value.page=a.page+1,i.value.per_page=a.rows,d()},M=async a=>{try{if((await fetch("/api/v1/company-context/switch",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify({company_id:a.id})})).ok)f.value.add({severity:"success",summary:"Success",detail:`Switched to ${a.name}`,life:2e3}),setTimeout(()=>{window.location.reload()},1e3);else throw new Error("Failed to switch company")}catch(l){console.error("Failed to switch company:",l),f.value.add({severity:"error",summary:"Error",detail:"Failed to switch company",life:3e3})}},J=async a=>{if(confirm(`Are you sure you want to deactivate ${a.name}?`))try{if((await fetch(`/api/v1/companies/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")},body:JSON.stringify({is_active:!1})})).ok)f.value.add({severity:"success",summary:"Success",detail:`${a.name} has been deactivated`,life:3e3}),d();else throw new Error("Failed to deactivate company")}catch(l){console.error("Failed to deactivate company:",l),f.value.add({severity:"error",summary:"Error",detail:"Failed to deactivate company",life:3e3})}},X=a=>new Date(a).toLocaleDateString(),Z=a=>I.find(c=>c.value===a)?.label||a,T=a=>a?"success":"danger";return Q(()=>{d()}),W(n,a=>{a&&d()}),(a,l)=>{const c=ee("tooltip");return g(),te("div",ce,[t(e(le),{ref_key:"toast",ref:f},null,512),o("div",ue,[l[4]||(l[4]=o("div",null,[o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Companies "),o("p",{class:"text-gray-600 dark:text-gray-400 mt-1"}," Manage your companies and switch between them ")],-1)),o("div",de,[t(e(p),{onClick:U,loading:x.value,icon:"pi pi-refresh",label:"Refresh",severity:"secondary",outlined:""},null,8,["loading"]),E.value?(g(),b(e($),{key:0,href:"/companies/create"},{default:r(()=>[t(e(p),{icon:"pi pi-plus",label:"Create Company"})]),_:1})):w("",!0)])]),n.value?(g(),b(e(A),{key:0,class:"mb-6"},{content:r(()=>[o("div",pe,[o("div",me,[t(e(L),{label:n.value.name.charAt(0),class:"bg-primary text-primary-contrast",size:"large"},null,8,["label"]),o("div",null,[o("h3",ve,y(n.value.name),1),o("p",ye,y(n.value.industry)+" â€¢ "+y(n.value.currency),1)]),t(e(P),{value:n.value.userRole,severity:T(n.value.isActive)},null,8,["value","severity"])]),l[5]||(l[5]=o("div",{class:"text-sm text-gray-500"}," Currently active company ",-1))])]),_:1})):w("",!0),t(e(A),{class:"mb-6"},{title:r(()=>[...l[6]||(l[6]=[V("Filters",-1)])]),content:r(()=>[o("div",fe,[t(e(oe),null,{default:r(()=>[t(e(re),{class:"pi pi-search"}),t(e(ie),{modelValue:u.value.search,"onUpdate:modelValue":l[0]||(l[0]=s=>u.value.search=s),placeholder:"Search companies...",onKeyup:ae(_,["enter"])},null,8,["modelValue"])]),_:1}),t(e(N),{modelValue:u.value.industry,"onUpdate:modelValue":l[1]||(l[1]=s=>u.value.industry=s),options:I,"option-label":"label","option-value":"value",placeholder:"Select Industry","show-clear":"",onChange:_},null,8,["modelValue"]),t(e(N),{modelValue:u.value.is_active,"onUpdate:modelValue":l[2]||(l[2]=s=>u.value.is_active=s),options:D,"option-label":"label","option-value":"value",placeholder:"Select Status","show-clear":"",onChange:_},null,8,["modelValue"]),t(e(N),{modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=s=>h.value=s),options:B,"option-label":"label","option-value":"value",placeholder:"Sort By",onChange:_},null,8,["modelValue"])]),o("div",ge,[t(e(p),{onClick:_,label:"Apply Filters",icon:"pi pi-filter",size:"small"}),t(e(p),{onClick:K,label:"Clear",severity:"secondary",outlined:"",size:"small"})])]),_:1}),t(e(A),null,{content:r(()=>[t(e(se),{value:O.value,loading:x.value,"total-records":R.value,paginator:!0,rows:i.value.per_page,first:(i.value.page-1)*i.value.per_page,lazy:"","paginator-template":"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown","current-page-report-template":"Showing {first} to {last} of {totalRecords} companies",onSort:q,onPage:H,"sort-field":"name","sort-order":1,scrollable:"","scroll-height":"flex"},{empty:r(()=>[o("div",xe,[l[7]||(l[7]=o("i",{class:"pi pi-building text-4xl text-gray-400"},null,-1)),l[8]||(l[8]=o("p",{class:"text-gray-500 dark:text-gray-400 mt-4"}," No companies found ",-1)),E.value?(g(),b(e($),{key:0,href:"/companies/create"},{default:r(()=>[t(e(p),{label:"Create your first company",icon:"pi pi-plus",class:"mt-4"})]),_:1})):w("",!0)])]),default:r(()=>[t(e(m),{field:"name",header:"Company",sortable:""},{body:r(({data:s})=>[o("div",he,[t(e(L),{label:s.name.charAt(0),class:"bg-primary text-primary-contrast"},null,8,["label"]),o("div",null,[o("div",_e,y(s.name),1),o("div",be,y(s.slug),1)])])]),_:1}),t(e(m),{field:"industry",header:"Industry",sortable:""},{body:r(({data:s})=>[V(y(Z(s.industry)),1)]),_:1}),t(e(m),{field:"country",header:"Country",sortable:""}),t(e(m),{field:"currency",header:"Currency",sortable:""}),t(e(m),{field:"user_role",header:"Your Role"},{body:r(({data:s})=>[t(e(P),{value:s.user_role,severity:s.user_role==="owner"?"success":"info"},null,8,["value","severity"])]),_:1}),t(e(m),{field:"is_active",header:"Status",sortable:""},{body:r(({data:s})=>[t(e(P),{value:s.is_active?"Active":"Inactive",severity:T(s.is_active)},null,8,["value","severity"])]),_:1}),t(e(m),{field:"created_at",header:"Created",sortable:""},{body:r(({data:s})=>[V(y(X(s.created_at)),1)]),_:1}),t(e(m),{header:"Actions"},{body:r(({data:s})=>[o("div",we,[s.id!==n.value?.id?F((g(),b(e(p),{key:0,onClick:C=>M(s),icon:"pi pi-sign-in",size:"small",severity:"secondary",outlined:""},null,8,["onClick"])),[[c,"Switch to this company"]]):w("",!0),t(e($),{href:`/companies/${s.id}`},{default:r(()=>[F(t(e(p),{icon:"pi pi-eye",size:"small",severity:"secondary",outlined:""},null,512),[[c,"View details"]])]),_:1},8,["href"]),s.is_active&&s.user_role==="owner"?F((g(),b(e(p),{key:1,onClick:C=>J(s),icon:"pi pi-times",size:"small",severity:"danger",outlined:""},null,8,["onClick"])),[[c,"Deactivate company"]]):w("",!0)])]),_:1})]),_:1},8,["value","loading","total-records","rows","first"])]),_:1})])}}},je=ne(Ce,[["__scopeId","data-v-84471aa1"]]);export{je as default};
