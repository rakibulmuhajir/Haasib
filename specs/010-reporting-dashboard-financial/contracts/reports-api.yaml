openapi: 3.0.3
info:
  title: Reporting Dashboard API
  version: 1.0.0
  description: API for generating and managing financial reports and dashboards

paths:
  /api/v1/dashboard:
    get:
      summary: Get dashboard with KPIs and metrics
      tags: [Dashboard]
      parameters:
        - name: company_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: date_from
          in: query
          schema:
            type: string
            format: date
        - name: date_to
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                type: object
                properties:
                  kpis:
                    type: array
                    items:
                      $ref: '#/components/schemas/KPI'
                  charts:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChartData'
                  period_comparison:
                    $ref: '#/components/schemas/PeriodComparison'

  /api/v1/reports:
    get:
      summary: List reports
      tags: [Reports]
      parameters:
        - name: company_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/ReportType'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ReportStatus'
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of reports
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Report'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'

    post:
      summary: Create new report
      tags: [Reports]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReportRequest'
      responses:
        '201':
          description: Report created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        '422':
          description: Validation error

  /api/v1/reports/{id}:
    get:
      summary: Get report details
      tags: [Reports]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Report details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        '404':
          description: Report not found

    delete:
      summary: Delete report
      tags: [Reports]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Report deleted

  /api/v1/reports/{id}/download:
    get:
      summary: Download generated report
      tags: [Reports]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: format
          in: query
          schema:
            type: string
            enum: [pdf, excel, csv]
      responses:
        '200':
          description: Report file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /api/v1/reports/types/income-statement:
    post:
      summary: Generate income statement
      tags: [Reports]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IncomeStatementRequest'
      responses:
        '200':
          description: Income statement data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IncomeStatement'

  /api/v1/reports/types/balance-sheet:
    post:
      summary: Generate balance sheet
      tags: [Reports]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BalanceSheetRequest'
      responses:
        '200':
          description: Balance sheet data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BalanceSheet'

  /api/v1/reports/types/cash-flow:
    post:
      summary: Generate cash flow statement
      tags: [Reports]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CashFlowRequest'
      responses:
        '200':
          description: Cash flow data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashFlow'

  /api/v1/reports/types/trial-balance:
    post:
      summary: Generate trial balance
      tags: [Reports]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrialBalanceRequest'
      responses:
        '200':
          description: Trial balance data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrialBalance'

  /api/v1/reports/templates:
    get:
      summary: List report templates
      tags: [Templates]
      responses:
        '200':
          description: List of templates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReportTemplate'

    post:
      summary: Create report template
      tags: [Templates]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplateRequest'
      responses:
        '201':
          description: Template created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportTemplate'

  /api/v1/reports/schedules:
    get:
      summary: List scheduled reports
      tags: [Schedules]
      responses:
        '200':
          description: List of schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReportSchedule'

    post:
      summary: Create scheduled report
      tags: [Schedules]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScheduleRequest'
      responses:
        '201':
          description: Schedule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportSchedule'

components:
  schemas:
    ReportType:
      type: string
      enum: [income_statement, balance_sheet, cash_flow, trial_balance, aging_report, kpi_dashboard]

    ReportStatus:
      type: string
      enum: [pending, processing, completed, failed]

    KPI:
      type: object
      properties:
        name:
          type: string
        value:
          type: number
        format:
          type: string
          enum: [currency, percentage, number, days]
        change:
          type: number
        change_percent:
          type: number
        trend:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              value:
                type: number

    ChartData:
      type: object
      properties:
        type:
          type: string
          enum: [line, bar, pie]
        title:
          type: string
        data:
          type: array
          items:
            type: object
        labels:
          type: array
          items:
            type: string

    PeriodComparison:
      type: object
      properties:
        current_period:
          $ref: '#/components/schemas/PeriodData'
        previous_period:
          $ref: '#/components/schemas/PeriodData'
        variance:
          type: object
          properties:
            amount:
              type: number
            percentage:
              type: number

    PeriodData:
      type: object
      properties:
        revenue:
          type: number
        expenses:
          type: number
        profit:
          type: number
        margin:
          type: number

    Report:
      type: object
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/ReportType'
        title:
          type: string
        date_from:
          type: string
          format: date
        date_to:
          type: string
          format: date
        status:
          $ref: '#/components/schemas/ReportStatus'
        file_path:
          type: string
        generated_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    CreateReportRequest:
      type: object
      required: [type, date_from, date_to]
      properties:
        type:
          $ref: '#/components/schemas/ReportType'
        title:
          type: string
        date_from:
          type: string
          format: date
        date_to:
          type: string
          format: date
        filters:
          type: object
        parameters:
          type: object

    IncomeStatementRequest:
      type: object
      required: [date_from, date_to]
      properties:
        date_from:
          type: string
          format: date
        date_to:
          type: string
          format: date
        comparison_period:
          type: string
          enum: [previous_month, previous_quarter, previous_year]
        currency:
          type: string
        level_of_detail:
          type: string
          enum: [summary, detailed, full]

    IncomeStatement:
      type: object
      properties:
        revenue:
          $ref: '#/components/schemas/AccountGroup'
        expenses:
          $ref: '#/components/schemas/AccountGroup'
        gross_profit:
          type: number
        operating_income:
          type: number
        net_income:
          type: number
        currency:
          type: string

    BalanceSheetRequest:
      type: object
      required: [date_from, date_to]
      properties:
        date_from:
          type: string
          format: date
        date_to:
          type: string
          format: date
        as_of_date:
          type: string
          format: date
        currency:
          type: string
        include_zero_balances:
          type: boolean

    BalanceSheet:
      type: object
      properties:
        assets:
          $ref: '#/components/schemas/BalanceSheetSection'
        liabilities:
          $ref: '#/components/schemas/BalanceSheetSection'
        equity:
          $ref: '#/components/schemas/BalanceSheetSection'
        total_assets:
          type: number
        total_liabilities_equity:
          type: number
        currency:
          type: string

    BalanceSheetSection:
      type: object
      properties:
        title:
          type: string
        accounts:
          type: array
          items:
            $ref: '#/components/schemas/BalanceSheetAccount'
        total:
          type: number

    BalanceSheetAccount:
      type: object
      properties:
        name:
          type: string
        balance:
          type: number
        sub_accounts:
          type: array
          items:
            $ref: '#/components/schemas/BalanceSheetAccount'

    CashFlowRequest:
      type: object
      required: [date_from, date_to]
      properties:
        date_from:
          type: string
          format: date
        date_to:
          type: string
          format: date
        method:
          type: string
          enum: [direct, indirect]

    CashFlow:
      type: object
      properties:
        operating_activities:
          $ref: '#/components/schemas/CashFlowSection'
        investing_activities:
          $ref: '#/components/schemas/CashFlowSection'
        financing_activities:
          $ref: '#/components/schemas/CashFlowSection'
        net_cash_flow:
          type: number
        beginning_cash:
          type: number
        ending_cash:
          type: number
        currency:
          type: string

    CashFlowSection:
      type: object
      properties:
        title:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/CashFlowItem'
        total:
          type: number

    CashFlowItem:
      type: object
      properties:
        name:
          type: string
        amount:
          type: number

    TrialBalanceRequest:
      type: object
      required: [date_from, date_to]
      properties:
        date_from:
          type: string
          format: date
        date_to:
          type: string
          format: date
        currency:
          type: string
        include_inactive:
          type: boolean

    TrialBalance:
      type: object
      properties:
        accounts:
          type: array
          items:
            $ref: '#/components/schemas/TrialBalanceAccount'
        total_debits:
          type: number
        total_credits:
          type: number
        currency:
          type: string

    TrialBalanceAccount:
      type: object
      properties:
        code:
          type: string
        name:
          type: string
        type:
          type: string
          enum: [debit, credit]
        balance:
          type: number
        currency:
          type: string

    AccountGroup:
      type: object
      properties:
        title:
          type: string
        accounts:
          type: array
          items:
            $ref: '#/components/schemas/Account'
        total:
          type: number

    Account:
      type: object
      properties:
        name:
          type: string
        balance:
          type: number
        percentage:
          type: number

    ReportTemplate:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        report_type:
          $ref: '#/components/schemas/ReportType'
        layout:
          type: object
        is_public:
          type: boolean
        created_at:
          type: string
          format: date-time

    CreateTemplateRequest:
      type: object
      required: [name, report_type]
      properties:
        name:
          type: string
        report_type:
          $ref: '#/components/schemas/ReportType'
        layout:
          type: object
        is_public:
          type: boolean

    ReportSchedule:
      type: object
      properties:
        id:
          type: string
          format: uuid
        report_type:
          $ref: '#/components/schemas/ReportType'
        frequency:
          type: string
          enum: [daily, weekly, monthly, quarterly, yearly]
        recipients:
          type: array
          items:
            type: string
            format: email
        next_run_at:
          type: string
          format: date-time
        is_active:
          type: boolean

    CreateScheduleRequest:
      type: object
      required: [report_type, frequency, recipients]
      properties:
        report_type:
          $ref: '#/components/schemas/ReportType'
        frequency:
          type: string
          enum: [daily, weekly, monthly, quarterly, yearly]
        recipients:
          type: array
          items:
            type: string
            format: email
        parameters:
          type: object

    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
        last_page:
          type: integer
        per_page:
          type: integer
        total:
          type: integer

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - BearerAuth: []