import{d as H,s as _,q as w,x as J,c as x,a as t,u as e,h as K,w as i,b as a,y as W,e as u,t as d,o as v,F as Q,r as X,i as Z,j as S,B as ee,f as te}from"./app-B-wLZQl0.js";import{u as se,t as oe,v as ae,C as le,w as re}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import{u as ne}from"./useFormFeedback-CE35LO4q.js";import{_ as ie}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as de,a as ue,b as me,c as ce,Q as pe}from"./QuickAddModal-BiBdCYPB.js";import{_ as g}from"./index-D8JUok4n.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{_ as z}from"./Textarea.vue_vue_type_script_setup_true_lang-DrbQ2zws.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_ as fe}from"./Separator.vue_vue_type_script_setup_true_lang-8_dGzQCj.js";import{_ as _e,a as ve}from"./CardContent.vue_vue_type_script_setup_true_lang-f-xi8uWj.js";import{_ as ye}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cn7HWfaF.js";import{_ as xe}from"./CardTitle.vue_vue_type_script_setup_true_lang-DXA8XANX.js";import{P as ge}from"./plus-C63jdNg7.js";import{T as he}from"./trash-2-BxVbfljz.js";import{S as be}from"./send-C-rqTrkv.js";import{S as we}from"./save-CBmuHaqJ.js";import{A as Ve}from"./arrow-left-DSX0n2_N.js";import"./useForwardExpose-Ca12vFmR.js";import"./VisuallyHidden-BZkMfMV2.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./Collection-DN_gmv-a.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./createLucideIcon-CbxkoCx6.js";import"./check-DogY6QNG.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./file-text-CFHWSPvd.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./loader-circle-BSwxCoSE.js";import"./info-_qQ0Rbsf.js";import"./circle-check-YKnAkXoj.js";import"./index-a73qSWOM.js";import"./PopoverTrigger.vue_vue_type_script_setup_true_lang-BiuISOh6.js";import"./user-tDll6vy-.js";import"./clock-9a58COAh.js";import"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./nullish-CHIgUVhi.js";import"./SelectGroup.vue_vue_type_script_setup_true_lang-Cng8hgfl.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-yNvHsWJi.js";import"./RovingFocusItem-PDr5bOed.js";import"./percent-CJFopfja.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DUuIDTHQ.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CLZwVYr3.js";const Ce={class:"mx-auto w-full max-w-5xl"},$e={class:"space-y-5 lg:col-span-7"},ke={class:"space-y-1.5"},Se={class:"space-y-2"},Ue={class:"flex items-center justify-between gap-3"},Ie={class:"space-y-3"},Te={class:"mb-3 flex items-center justify-between gap-2"},De={class:"text-sm font-medium text-foreground"},je={class:"flex flex-col gap-3 sm:flex-row sm:items-start"},qe={class:"flex-1 space-y-1.5"},Ae={class:"w-full space-y-1.5 sm:w-[220px]"},Ne={class:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},Fe={class:"flex items-center gap-2"},Qe={key:0,class:"flex items-center justify-between gap-3 sm:justify-end"},ze={class:"space-y-1.5"},Le={class:"grid gap-4 sm:grid-cols-2"},Me={class:"space-y-2"},Be={class:"space-y-2"},Ee={class:"space-y-2"},Pe={class:"lg:col-span-5"},Re={class:"text-4xl font-semibold leading-none tabular-nums"},Oe={class:"space-y-2 rounded-lg border border-border/70 bg-muted/15 p-3"},Ye={class:"flex justify-between text-sm"},Ge={class:"text-muted-foreground"},He={class:"tabular-nums text-foreground/90"},Je={key:0,class:"flex justify-between text-sm animate-in fade-in duration-200"},Ke={class:"text-muted-foreground"},We={class:"tabular-nums text-foreground/90"},Xe={class:"flex flex-col gap-2.5"},Ze={class:"text-xs text-muted-foreground"},Wt=H({__name:"QuickCreate",props:{company:{},recentCustomers:{},defaultTaxCode:{},defaultTerms:{}},setup(V){const m=V,{t:r,tpl:I}=se(),{showSuccess:T,showError:D}=ne(),L=_(()=>[{title:"Dashboard",href:"/dashboard"},{title:m.company.name,href:`/${m.company.slug}`},{title:r("invoices"),href:`/${m.company.slug}/invoices`},{title:r("newInvoice")}]),h=w(!1),j=w(null),c=w(m.defaultTaxCode||null),C=w(!1),q=()=>({description:"",quantity:1,unit_price:null}),o=J({customer_id:null,apply_tax:!1,line_items:[q()],due_date:null,invoice_date:new Date().toISOString().split("T")[0],reference:"",notes:""}),A=_(()=>j.value?.payment_terms||m.company.default_payment_terms||m.defaultTerms||30),b=_(()=>o.line_items),$=_(()=>b.value.reduce((l,s)=>{const n=s.unit_price??0;return l+s.quantity*n},0)),N=_(()=>!o.apply_tax||!c.value?0:$.value*(c.value.rate/100)),M=_(()=>$.value+N.value),B=_(()=>!!o.customer_id&&b.value.length>0&&b.value.every(l=>l.description.trim().length>0)&&b.value.every(l=>(l.unit_price??0)>0)),F=l=>{j.value=l,o.customer_id=l.id},E=()=>{o.line_items.push(q())},P=l=>{o.line_items.length<=1||o.line_items.splice(l,1)},R=l=>{F(l),h.value=!1},O=l=>{c.value=l},Y=()=>{o.transform(l=>({...l,status:"draft",line_items:l.line_items.map(s=>({description:s.description,quantity:s.quantity,unit_price:s.unit_price??0,tax_rate:l.apply_tax&&c.value?c.value.rate:null,discount_amount:null,income_account_id:null}))})).post(`/${m.company.slug}/invoices`,{preserveScroll:!0,onSuccess:()=>{T(r("invoiceSaved"))},onError:l=>D(l)})},G=()=>{o.transform(l=>({...l,status:"approved",send_immediately:!0,line_items:l.line_items.map(s=>({description:s.description,quantity:s.quantity,unit_price:s.unit_price??0,tax_rate:l.apply_tax&&c.value?c.value.rate:null,discount_amount:null,income_account_id:null}))})).post(`/${m.company.slug}/invoices`,{preserveScroll:!0,onSuccess:()=>{T(r("invoiceSent"))},onError:l=>D(l)})},k=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:m.company.base_currency||"USD"}).format(l);return(l,s)=>(v(),x(Q,null,[t(e(K),{title:e(r)("newInvoice")},null,8,["title"]),t(ie,{title:e(r)("newInvoice"),breadcrumbs:L.value},{actions:i(()=>[t(e(g),{variant:"outline",onClick:s[0]||(s[0]=n=>e(te).get(`/${V.company.slug}/invoices`))},{default:i(()=>[t(e(Ve),{class:"mr-2 h-4 w-4"}),u(" "+d(e(r)("back")),1)]),_:1})]),default:i(()=>[a("div",Ce,[a("form",{onSubmit:s[9]||(s[9]=W(()=>{},["prevent"])),class:"grid gap-5 lg:grid-cols-12 lg:gap-7"},[a("div",$e,[a("div",ke,[t(e(f),{class:"text-sm font-semibold text-foreground"},{default:i(()=>[u(d(e(r)("whoIsThisFor")),1)]),_:1}),t(e(de),{modelValue:e(o).customer_id,"onUpdate:modelValue":s[1]||(s[1]=n=>e(o).customer_id=n),"entity-type":"customer",placeholder:e(r)("searchCustomers"),onEntitySelected:F,onQuickAddClick:s[2]||(s[2]=n=>h.value=!0),error:e(o).errors.customer_id},null,8,["modelValue","placeholder","error"])]),a("div",Se,[a("div",Ue,[t(e(f),{class:"text-sm font-semibold text-foreground"},{default:i(()=>[u(d(e(r)("whatDidYouSell")),1)]),_:1}),t(e(g),{type:"button",variant:"ghost",size:"sm",class:"-mr-2",onClick:E},{default:i(()=>[t(e(ge),{class:"h-4 w-4"}),u(" "+d(e(r)("addLine")),1)]),_:1})]),a("div",Ie,[(v(!0),x(Q,null,X(e(o).line_items,(n,y)=>(v(),x("div",{key:y,class:"rounded-xl border border-border/70 bg-muted/10 p-3"},[a("div",Te,[a("div",De,d(e(I)("itemNumber",{number:y+1})),1),e(o).line_items.length>1?(v(),Z(e(g),{key:0,type:"button",variant:"ghost",size:"icon",class:"h-8 w-8 text-muted-foreground hover:text-foreground",onClick:p=>P(y)},{default:i(()=>[t(e(he),{class:"h-4 w-4"})]),_:1},8,["onClick"])):S("",!0)]),a("div",je,[a("div",qe,[t(e(z),{modelValue:n.description,"onUpdate:modelValue":p=>n.description=p,placeholder:e(r)("descriptionPlaceholder"),rows:"2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),a("div",Ae,[t(e(f),{class:"text-xs font-medium text-muted-foreground"},{default:i(()=>[u(d(e(r)("howMuch")),1)]),_:1}),t(e(ue),{modelValue:n.unit_price,"onUpdate:modelValue":p=>n.unit_price=p,currency:V.company.base_currency,size:y===0?"lg":"md"},null,8,["modelValue","onUpdate:modelValue","currency","size"])])]),a("div",Ne,[a("div",Fe,[t(e(f),{class:"text-xs font-medium text-muted-foreground"},{default:i(()=>[...s[11]||(s[11]=[u("Qty",-1)])]),_:1}),t(e(U),{modelValue:n.quantity,"onUpdate:modelValue":p=>n.quantity=p,modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",class:"h-9 w-24"},null,8,["modelValue","onUpdate:modelValue"])]),y===0?(v(),x("div",Qe,[t(e(me),{modelValue:e(o).apply_tax,"onUpdate:modelValue":s[3]||(s[3]=p=>e(o).apply_tax=p),"entity-type":"customer","entity-id":e(o).customer_id,onTaxCodeResolved:O},null,8,["modelValue","entity-id"])])):S("",!0)])]))),128))])]),a("div",ze,[t(e(f),{class:"text-xs font-medium text-muted-foreground"},{default:i(()=>[u(d(e(r)("dueIn")),1)]),_:1}),t(e(ce),{modelValue:e(o).due_date,"onUpdate:modelValue":s[4]||(s[4]=n=>e(o).due_date=n),"invoice-date":e(o).invoice_date,"default-terms":A.value,error:e(o).errors.due_date},null,8,["modelValue","invoice-date","default-terms","error"])]),t(e(fe),{class:"opacity-60"}),t(e(oe),{open:C.value,"onUpdate:open":s[8]||(s[8]=n=>C.value=n)},{default:i(()=>[t(e(ae),{class:"flex w-full items-center justify-between rounded-lg border border-border/70 bg-muted/30 px-3 py-2 text-sm text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground"},{default:i(()=>[a("span",null,d(e(r)("addMoreDetails")),1),t(e(le),{class:ee(["h-4 w-4 transition-transform",{"rotate-90":C.value}])},null,8,["class"])]),_:1}),t(e(re),{class:"mt-4 space-y-4"},{default:i(()=>[a("div",Le,[a("div",Me,[t(e(f),{class:"text-xs font-medium text-muted-foreground"},{default:i(()=>[u(d(e(r)("invoiceDate")),1)]),_:1}),t(e(U),{type:"date",modelValue:e(o).invoice_date,"onUpdate:modelValue":s[5]||(s[5]=n=>e(o).invoice_date=n)},null,8,["modelValue"])]),a("div",Be,[t(e(f),{class:"text-xs font-medium text-muted-foreground"},{default:i(()=>[u(d(e(r)("reference")),1)]),_:1}),t(e(U),{modelValue:e(o).reference,"onUpdate:modelValue":s[6]||(s[6]=n=>e(o).reference=n),placeholder:e(r)("referencePlaceholder")},null,8,["modelValue","placeholder"])])]),a("div",Ee,[t(e(f),{class:"text-xs font-medium text-muted-foreground"},{default:i(()=>[u(d(e(r)("customerNotes")),1)]),_:1}),t(e(z),{modelValue:e(o).notes,"onUpdate:modelValue":s[7]||(s[7]=n=>e(o).notes=n),placeholder:e(r)("customerNotesPlaceholder"),rows:"2"},null,8,["modelValue","placeholder"])])]),_:1})]),_:1},8,["open"])]),a("div",Pe,[t(e(_e),{class:"lg:sticky lg:top-20 overflow-hidden"},{default:i(()=>[t(e(ye),{class:"space-y-1 pb-3"},{default:i(()=>[t(e(xe),{class:"text-xs font-medium tracking-wide text-muted-foreground uppercase"},{default:i(()=>[u(d(e(r)("total")),1)]),_:1}),a("div",Re,d(k(M.value)),1)]),_:1}),t(e(ve),{class:"space-y-3"},{default:i(()=>[a("div",Oe,[a("div",Ye,[a("span",Ge,d(e(r)("subtotal")),1),a("span",He,d(k($.value)),1)]),e(o).apply_tax&&c.value?(v(),x("div",Je,[a("span",Ke,d(e(r)("tax"))+" ("+d(c.value.rate)+"%)",1),a("span",We,d(k(N.value)),1)])):S("",!0)]),a("div",Xe,[t(e(g),{type:"button",onClick:G,disabled:e(o).processing||!B.value,size:"lg",class:"w-full bg-gradient-to-r from-teal-600 to-emerald-600 text-white shadow-md shadow-teal-600/20 hover:from-teal-700 hover:to-emerald-700 disabled:opacity-50"},{default:i(()=>[t(e(be),{class:"mr-2 h-4 w-4"}),u(" "+d(e(r)("sendInvoice")),1)]),_:1},8,["disabled"]),t(e(g),{type:"button",variant:"ghost",onClick:Y,disabled:e(o).processing,class:"w-full"},{default:i(()=>[t(e(we),{class:"mr-2 h-4 w-4"}),u(" "+d(e(r)("saveDraft")),1)]),_:1},8,["disabled"])]),a("p",Ze,d(e(I)("dueInDays",{days:A.value})),1)]),_:1})]),_:1})])],32)]),t(e(pe),{open:h.value,"onUpdate:open":s[10]||(s[10]=n=>h.value=n),"entity-type":"customer",onCreated:R},null,8,["open"])]),_:1},8,["title","breadcrumbs"])],64))}});export{Wt as default};
