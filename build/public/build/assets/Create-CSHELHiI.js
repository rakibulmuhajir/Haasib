import{d as M,x as R,q as T,K as O,s as H,c as f,a as l,u as t,h as I,w as n,b as u,y as K,e as d,o as s,F as y,r as b,i as k,t as p,f as C}from"./app-B-wLZQl0.js";import{_ as L}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as W}from"./index-D8JUok4n.js";import{_ as v}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_ as c}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{_ as V,a as g,b as B,c as x,d as m}from"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import{_ as z}from"./Textarea.vue_vue_type_script_setup_true_lang-DrbQ2zws.js";import{u as G}from"./useFormFeedback-CE35LO4q.js";import{S as J}from"./save-CBmuHaqJ.js";import{C as Q}from"./credit-card-CZIyPTcw.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import"./useForwardExpose-Ca12vFmR.js";import"./VisuallyHidden-BZkMfMV2.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./Collection-DN_gmv-a.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./createLucideIcon-CbxkoCx6.js";import"./plus-C63jdNg7.js";import"./check-DogY6QNG.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./file-text-CFHWSPvd.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";import"./loader-circle-BSwxCoSE.js";import"./info-_qQ0Rbsf.js";import"./circle-check-YKnAkXoj.js";import"./index-a73qSWOM.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./nullish-CHIgUVhi.js";const X={class:"grid gap-4 md:grid-cols-2"},Y={class:"md:col-span-2"},Z={class:"space-y-3"},h={key:0,class:"text-sm text-muted-foreground"},ee={key:1,class:"space-y-3"},te={class:"font-medium"},le={class:"text-xs text-muted-foreground"},ae={class:"flex justify-between text-sm"},oe={class:"flex justify-end gap-3"},Oe=M({__name:"Create",props:{company:{},vendors:{},unpaidBills:{},selectedBill:{},filters:{},bankAccounts:{},apAccounts:{}},setup($){const r=$,F=[{title:"Dashboard",href:`/${r.company.slug}`},{title:"Bill Payments",href:`/${r.company.slug}/bill-payments`},{title:"Create",href:`/${r.company.slug}/bill-payments/create`}],{showSuccess:P,showError:A}=G(),o=R({vendor_id:r.selectedBill?.vendor_id??r.filters?.vendor_id??"",payment_date:new Date().toISOString().slice(0,10),amount:r.selectedBill?.balance??0,currency:r.selectedBill?.currency??r.company.base_currency,base_currency:r.company.base_currency,payment_method:"bank_transfer",reference_number:"",notes:r.selectedBill?`Payment for ${r.selectedBill.bill_number}`:"",payment_account_id:"",ap_account_id:"",allocations:r.selectedBill?[{bill_id:r.selectedBill.id,amount_allocated:r.selectedBill.balance}]:[]}),_=T(r.unpaidBills??[]),w=i=>{r.selectedBill&&o.allocations.length>0||(o.allocations=i.map(e=>({bill_id:e.id,amount_allocated:0})))};O(()=>r.unpaidBills,i=>{_.value=i??[],w(_.value)},{immediate:!0});const N=i=>{if(o.vendor_id=i,!i){_.value=[],o.allocations=[];return}C.get(`/${r.company.slug}/bill-payments/create`,{vendor_id:i},{preserveState:!0,preserveScroll:!0,replace:!0,only:["unpaidBills"],onSuccess:e=>{const a=e.props.unpaidBills??[];_.value=a,w(_.value)}})},U=H(()=>o.allocations.reduce((i,e)=>i+(Number(e.amount_allocated)||0),0)),D=(i,e)=>{const a=o.allocations.find(S=>S.bill_id===i);if(a){a.amount_allocated=e;return}o.allocations.push({bill_id:i,amount_allocated:e})},q=i=>o.allocations.find(e=>e.bill_id===i)?.amount_allocated??0,j=(i,e=2)=>new Intl.NumberFormat("en-US",{minimumFractionDigits:e,maximumFractionDigits:e}).format(i),E=()=>{if(U.value-o.amount>1e-6){A("Allocations exceed payment amount");return}const i={vendor_id:o.vendor_id,payment_date:o.payment_date,amount:o.amount,currency:o.currency,base_currency:o.base_currency,payment_method:o.payment_method,reference_number:o.reference_number||null,notes:o.notes||null,payment_account_id:o.payment_account_id,ap_account_id:o.ap_account_id||null,allocations:o.allocations.filter(e=>e.amount_allocated>0)};o.transform(()=>i).post(`/${r.company.slug}/bill-payments`,{preserveScroll:!0,onSuccess:()=>{P("Bill payment recorded successfully"),C.visit(`/${r.company.slug}/bill-payments`)},onError:e=>{console.error("Validation errors:",e),A(e)}})};return(i,e)=>(s(),f(y,null,[l(t(I),{title:"Record Bill Payment"}),l(L,{title:"Record Bill Payment",breadcrumbs:F,icon:t(Q)},{default:n(()=>[u("form",{class:"space-y-6",onSubmit:K(E,["prevent"])},[u("div",X,[u("div",null,[l(t(c),{for:"vendor_id"},{default:n(()=>[...e[8]||(e[8]=[d("Vendor",-1)])]),_:1}),l(t(V),{"model-value":t(o).vendor_id,"onUpdate:modelValue":N},{default:n(()=>[l(t(g),null,{default:n(()=>[l(t(B),{placeholder:"Select vendor"})]),_:1}),l(t(x),null,{default:n(()=>[(s(!0),f(y,null,b($.vendors,a=>(s(),k(t(m),{key:a.id,value:a.id},{default:n(()=>[d(p(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])]),u("div",null,[l(t(c),{for:"payment_date"},{default:n(()=>[...e[9]||(e[9]=[d("Payment Date",-1)])]),_:1}),l(t(v),{id:"payment_date",modelValue:t(o).payment_date,"onUpdate:modelValue":e[0]||(e[0]=a=>t(o).payment_date=a),type:"date",required:""},null,8,["modelValue"])]),u("div",null,[l(t(c),{for:"amount"},{default:n(()=>[...e[10]||(e[10]=[d("Amount",-1)])]),_:1}),l(t(v),{id:"amount",modelValue:t(o).amount,"onUpdate:modelValue":e[1]||(e[1]=a=>t(o).amount=a),modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",required:""},null,8,["modelValue"])]),u("div",null,[l(t(c),{for:"currency"},{default:n(()=>[...e[11]||(e[11]=[d("Currency",-1)])]),_:1}),l(t(v),{id:"currency",modelValue:t(o).currency,"onUpdate:modelValue":e[2]||(e[2]=a=>t(o).currency=a),maxlength:"3"},null,8,["modelValue"])]),u("div",null,[l(t(c),{for:"payment_account_id"},{default:n(()=>[...e[12]||(e[12]=[d("Pay From *",-1)])]),_:1}),l(t(V),{modelValue:t(o).payment_account_id,"onUpdate:modelValue":e[3]||(e[3]=a=>t(o).payment_account_id=a),required:""},{default:n(()=>[l(t(g),{id:"payment_account_id"},{default:n(()=>[l(t(B),{placeholder:"Select bank/cash account"})]),_:1}),l(t(x),null,{default:n(()=>[(s(!0),f(y,null,b(r.bankAccounts||[],a=>(s(),k(t(m),{key:a.id,value:a.id},{default:n(()=>[d(p(a.code)+" — "+p(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),u("div",null,[l(t(c),{for:"ap_account_id"},{default:n(()=>[...e[13]||(e[13]=[d("AP Account",-1)])]),_:1}),l(t(V),{modelValue:t(o).ap_account_id,"onUpdate:modelValue":e[4]||(e[4]=a=>t(o).ap_account_id=a)},{default:n(()=>[l(t(g),{id:"ap_account_id"},{default:n(()=>[l(t(B),{placeholder:"Use company default"})]),_:1}),l(t(x),null,{default:n(()=>[l(t(m),{value:"__none"},{default:n(()=>[...e[14]||(e[14]=[d("Use company default",-1)])]),_:1}),(s(!0),f(y,null,b(r.apAccounts||[],a=>(s(),k(t(m),{key:a.id,value:a.id},{default:n(()=>[d(p(a.code)+" — "+p(a.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),u("div",null,[l(t(c),{for:"payment_method"},{default:n(()=>[...e[15]||(e[15]=[d("Method",-1)])]),_:1}),l(t(V),{modelValue:t(o).payment_method,"onUpdate:modelValue":e[5]||(e[5]=a=>t(o).payment_method=a)},{default:n(()=>[l(t(g),null,{default:n(()=>[l(t(B),{placeholder:"Select method"})]),_:1}),l(t(x),null,{default:n(()=>[l(t(m),{value:"cash"},{default:n(()=>[...e[16]||(e[16]=[d("Cash",-1)])]),_:1}),l(t(m),{value:"check"},{default:n(()=>[...e[17]||(e[17]=[d("Check",-1)])]),_:1}),l(t(m),{value:"card"},{default:n(()=>[...e[18]||(e[18]=[d("Card",-1)])]),_:1}),l(t(m),{value:"bank_transfer"},{default:n(()=>[...e[19]||(e[19]=[d("Bank Transfer",-1)])]),_:1}),l(t(m),{value:"ach"},{default:n(()=>[...e[20]||(e[20]=[d("ACH",-1)])]),_:1}),l(t(m),{value:"wire"},{default:n(()=>[...e[21]||(e[21]=[d("Wire",-1)])]),_:1}),l(t(m),{value:"other"},{default:n(()=>[...e[22]||(e[22]=[d("Other",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),u("div",null,[l(t(c),{for:"reference_number"},{default:n(()=>[...e[23]||(e[23]=[d("Reference",-1)])]),_:1}),l(t(v),{id:"reference_number",modelValue:t(o).reference_number,"onUpdate:modelValue":e[6]||(e[6]=a=>t(o).reference_number=a)},null,8,["modelValue"])]),u("div",Y,[l(t(c),{for:"notes"},{default:n(()=>[...e[24]||(e[24]=[d("Notes",-1)])]),_:1}),l(t(z),{id:"notes",modelValue:t(o).notes,"onUpdate:modelValue":e[7]||(e[7]=a=>t(o).notes=a)},null,8,["modelValue"])])]),u("div",Z,[e[25]||(e[25]=u("div",{class:"text-lg font-semibold"},"Allocations",-1)),_.value.length?(s(),f("div",ee,[(s(!0),f(y,null,b(_.value,a=>(s(),f("div",{key:a.id,class:"flex items-center justify-between rounded border p-3"},[u("div",null,[u("div",te,p(a.bill_number),1),u("div",le,"Balance "+p(j(a.balance))+" "+p(a.currency),1)]),l(t(v),{class:"w-32",type:"number",min:"0",step:"0.01",value:q(a.id),placeholder:"Allocate",onInput:S=>D(a.id,parseFloat(S.target.value)||0)},null,8,["value","onInput"])]))),128))])):(s(),f("div",h," Select a vendor to load unpaid bills. "))]),u("div",ae,[e[26]||(e[26]=u("span",null,"Total Allocated",-1)),u("span",null,p(U.value.toFixed(2)),1)]),u("div",oe,[l(t(W),{type:"submit",disabled:t(o).processing},{default:n(()=>[l(t(J),{class:"mr-2 h-4 w-4"}),d(" "+p(t(o).processing?"Saving...":"Save Payment"),1)]),_:1},8,["disabled"])])],32)]),_:1},8,["icon"])],64))}});export{Oe as default};
