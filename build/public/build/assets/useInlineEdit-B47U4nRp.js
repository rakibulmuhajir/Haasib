import{d as P,I as $,J as j,s as y,c as f,b as V,j as x,a as c,i as m,u as s,w as d,e as B,t as p,O as q,F as J,r as O,ak as X,B as G,A as H,o,q as h,x as Q,C as z}from"./app-B-wLZQl0.js";import{_ as w}from"./index-D8JUok4n.js";import{_ as R}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{a as W,b as Y,c as Z,_ as N,d as _}from"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import{_ as ee}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{P as le}from"./pencil-R0Fiz8Cs.js";import{L as te}from"./loader-circle-BSwxCoSE.js";import{C as ae}from"./check-DogY6QNG.js";import{X as se}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";const ne={class:"space-y-1.5"},oe={class:"flex items-center justify-between"},ie={key:0,class:"flex items-center gap-2"},ue=["placeholder"],re={class:"flex items-center gap-2"},ce={key:2,class:"text-xs text-zinc-400"},Ee=P({__name:"InlineEditable",props:$({label:{},displayValue:{},editing:{type:Boolean},saving:{type:Boolean},canEdit:{type:Boolean,default:!0},type:{default:"text"},options:{},placeholder:{},helperText:{},icon:{},readonly:{type:Boolean,default:!1},valueClass:{default:""}},{modelValue:{},modelModifiers:{}}),emits:$(["startEdit","save","cancel"],["update:modelValue"]),setup(e,{emit:b}){const r=e,v=b,i=j(e,"modelValue"),k=y(()=>r.displayValue!==void 0?r.displayValue:r.type==="select"&&r.options&&r.options.find(l=>l.value===i.value)?.label||String(i.value||"â€”")),n=u=>{u.key==="Enter"&&r.type!=="textarea"?v("save"):u.key==="Escape"&&v("cancel")};return(u,l)=>(o(),f("div",ne,[V("div",oe,[c(s(ee),{class:"text-sm font-medium text-zinc-500"},{default:d(()=>[B(p(e.label),1)]),_:1}),e.canEdit&&!e.readonly&&!e.editing?(o(),m(s(w),{key:0,variant:"ghost",size:"sm",class:"h-6 px-2",onClick:l[0]||(l[0]=t=>v("startEdit"))},{default:d(()=>[c(s(le),{class:"h-3 w-3"})]),_:1})):x("",!0)]),e.editing?(o(),f("div",ie,[e.type==="text"||e.type==="email"||e.type==="number"?(o(),m(s(R),{key:0,modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=t=>i.value=t),type:e.type,placeholder:e.placeholder,class:"h-8",onKeydown:n},null,8,["modelValue","type","placeholder"])):e.type==="select"?(o(),m(s(N),{key:1,modelValue:i.value,"onUpdate:modelValue":[l[2]||(l[2]=t=>i.value=t),l[3]||(l[3]=t=>i.value=typeof e.options?.[0]?.value=="number"?Number(t):t)]},{default:d(()=>[c(s(W),{class:"h-8 w-full"},{default:d(()=>[c(s(Y),{placeholder:e.placeholder},null,8,["placeholder"])]),_:1}),c(s(Z),null,{default:d(()=>[(o(!0),f(J,null,O(e.options,t=>(o(),m(s(_),{key:t.value,value:t.value},{default:d(()=>[B(p(t.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):e.type==="textarea"?q((o(),f("textarea",{key:2,"onUpdate:modelValue":l[4]||(l[4]=t=>i.value=t),placeholder:e.placeholder,class:"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",onKeydown:n},null,40,ue)),[[X,i.value]]):x("",!0),c(s(w),{size:"sm",variant:"ghost",class:"h-8 w-8 p-0 shrink-0",disabled:e.saving,onClick:l[5]||(l[5]=t=>v("save"))},{default:d(()=>[e.saving?(o(),m(s(te),{key:0,class:"h-4 w-4 animate-spin"})):(o(),m(s(ae),{key:1,class:"h-4 w-4 text-green-600"}))]),_:1},8,["disabled"]),c(s(w),{size:"sm",variant:"ghost",class:"h-8 w-8 p-0 shrink-0",disabled:e.saving,onClick:l[6]||(l[6]=t=>v("cancel"))},{default:d(()=>[c(s(se),{class:"h-4 w-4 text-red-600"})]),_:1},8,["disabled"])])):(o(),f("div",{key:1,class:G(["text-base text-zinc-900",e.valueClass])},[V("div",re,[e.icon?(o(),m(H(e.icon),{key:0,class:"h-4 w-4 text-zinc-400"})):x("",!0),V("span",null,p(k.value),1)])],2)),e.helperText?(o(),f("p",ce,p(e.helperText),1)):x("",!0)]))}});function Ce(e){const{endpoint:b,onSuccess:r,onError:v,successMessage:i="Updated successfully",errorMessage:k="Failed to update"}=e,n=h(null),u=h(null),l=h({}),t=h({});function S(a,E){l.value[a]=E,t.value[a]=E;const T=y({get:()=>l.value[a],set:g=>{l.value[a]=g}}),A=y(()=>t.value[a]),U=y(()=>n.value===a),D=y(()=>u.value===a);return{value:T,originalValue:A,isEditing:U,isSaving:D,startEditing:()=>{t.value[a]=l.value[a],n.value=a},cancelEditing:()=>{l.value[a]=t.value[a],n.value=null},save:async()=>{u.value=a;const g=l.value[a],I=Q({[a]:g});return new Promise((K,L)=>{I.patch(b,{preserveScroll:!0,onSuccess:()=>{t.value[a]=g,n.value=null,u.value=null,z.success(i),r?.(a,g),K()},onError:C=>{u.value=null,z.error(k),v?.(a,C),L(C)}})})}}}const F=y(()=>n.value!==null),M=y(()=>u.value!==null);return{registerField:S,editingField:n,savingField:u,isAnyEditing:F,isAnySaving:M,cancelAll:()=>{n.value&&(l.value[n.value]=t.value[n.value]),n.value=null}}}export{Ee as _,Ce as u};
