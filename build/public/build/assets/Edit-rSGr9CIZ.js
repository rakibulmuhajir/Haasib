import{d as G,s as x,q as J,x as Q,K as R,c as $,a as t,u as e,h as W,w as l,j as X,b as s,o as b,e as d,t as a,y as Y,F as k,r as C,i as T,f as Z}from"./app-B-wLZQl0.js";import{_ as ee}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as D}from"./index-D8JUok4n.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_ as y}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{_ as E}from"./Textarea.vue_vue_type_script_setup_true_lang-DrbQ2zws.js";import{_ as S,a as F,b as L,c as N,d as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import{_ as g,a as h}from"./CardContent.vue_vue_type_script_setup_true_lang-f-xi8uWj.js";import{_ as j}from"./CardDescription.vue_vue_type_script_setup_true_lang-D23jLuEj.js";import{_ as w}from"./CardHeader.vue_vue_type_script_setup_true_lang-Cn7HWfaF.js";import{_ as I}from"./CardTitle.vue_vue_type_script_setup_true_lang-DXA8XANX.js";import{_ as te}from"./index-a73qSWOM.js";import{u as le}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import{P as ae}from"./plus-C63jdNg7.js";import{A as oe}from"./arrow-left-DSX0n2_N.js";import{S as ne}from"./save-CBmuHaqJ.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./loader-circle-BSwxCoSE.js";import"./createLucideIcon-CbxkoCx6.js";import"./info-_qQ0Rbsf.js";import"./circle-check-YKnAkXoj.js";import"./useForwardExpose-Ca12vFmR.js";import"./VisuallyHidden-BZkMfMV2.js";import"./Collection-DN_gmv-a.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./check-DogY6QNG.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./file-text-CFHWSPvd.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";const ie={key:0,class:"mb-6"},se={class:"flex items-center"},de={class:"text-sm"},ue={class:"grid grid-cols-12 gap-2 text-sm text-muted-foreground font-medium"},re={class:"col-span-5"},ce={class:"col-span-2"},me={class:"col-span-2"},_e={class:"col-span-2"},pe={class:"col-span-1"},fe={class:"col-span-5"},ve={class:"col-span-2"},be={class:"col-span-2"},ye={class:"col-span-2"},Ve={class:"col-span-2 flex items-center text-sm"},$e={class:"flex justify-between text-sm"},ge={class:"flex justify-between text-sm"},he={class:"flex justify-between text-lg font-bold"},st=G({__name:"Edit",props:{company:{},invoice:{},revenueAccounts:{},arAccounts:{}},setup(f){const u=f,{t:o}=le(),H=x(()=>[{title:o("dashboard"),href:"/dashboard"},{title:u.company.name,href:`/${u.company.slug}`},{title:o("invoices"),href:`/${u.company.slug}/invoices`},{title:u.invoice.invoice_number,href:`/${u.company.slug}/invoices/${u.invoice.id}`},{title:o("edit")}]),p=J([...u.invoice.line_items.map(_=>({..._}))]);p.value.length===0&&p.value.push({description:"",quantity:1,unit_price:0,tax_rate:0,discount_amount:0});const r=Q({customer_id:u.invoice.customer.id,line_items:p.value,ar_account_id:u.invoice.ar_account_id||"",currency:u.invoice.currency,invoice_date:u.invoice.invoice_date,due_date:u.invoice.due_date,description:u.invoice.description||"",reference:u.invoice.reference||"",payment_terms:u.invoice.payment_terms||30,notes:u.invoice.notes||""});R(p,_=>{r.line_items=_},{deep:!0});const B=x(()=>p.value.reduce((_,i)=>{const n=i.quantity*i.unit_price,v=i.discount_amount||0;return _+(n-v)},0)),M=x(()=>p.value.reduce((_,i)=>{const n=i.quantity*i.unit_price,v=i.discount_amount||0,c=n-v,z=(i.tax_rate||0)/100;return _+c*z},0)),K=x(()=>B.value+M.value),O=()=>{p.value.push({description:"",quantity:1,unit_price:0,tax_rate:0,discount_amount:0})},A=(_,i,n)=>{p.value[_][i]=n},P=()=>{r.put(`/${u.company.slug}/invoices/${u.invoice.id}`)},q=_=>new Intl.NumberFormat("en-US",{style:"currency",currency:r.currency||"USD"}).format(_),m=x(()=>u.invoice.status!=="paid"&&u.invoice.status!=="cancelled");return(_,i)=>(b(),$(k,null,[t(e(W),{title:`${e(o)("edit")} ${e(o)("invoices")} ${f.invoice.invoice_number}`},null,8,["title"]),t(ee,{title:`${e(o)("edit")} ${e(o)("invoices")} ${f.invoice.invoice_number}`,breadcrumbs:H.value},{actions:l(()=>[t(e(D),{variant:"outline",onClick:i[0]||(i[0]=n=>e(Z).get(`/${f.company.slug}/invoices/${f.invoice.id}`))},{default:l(()=>[t(e(oe),{class:"mr-2 h-4 w-4"}),d(" "+a(e(o)("cancel")),1)]),_:1}),t(e(D),{onClick:P,disabled:e(r).processing||!m.value},{default:l(()=>[t(e(ne),{class:"mr-2 h-4 w-4"}),d(" "+a(e(o)("saveChanges")),1)]),_:1},8,["disabled"])]),default:l(()=>[m.value?X("",!0):(b(),$("div",ie,[t(e(g),{class:"border-yellow-200 bg-yellow-50"},{default:l(()=>[t(e(h),{class:"pt-6"},{default:l(()=>[s("div",se,[t(e(te),{variant:"secondary",class:"mr-2"},{default:l(()=>[d(a(f.invoice.status),1)]),_:1}),s("span",de,a(e(o)("invoiceLocked")),1)])]),_:1})]),_:1})])),s("form",{onSubmit:Y(P,["prevent"]),class:"space-y-6"},[t(e(g),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(I),null,{default:l(()=>[d(a(e(o)("customerInformation")),1)]),_:1}),t(e(j),null,{default:l(()=>[d(a(e(o)("selectCustomerForInvoice")),1)]),_:1})]),_:1}),t(e(h),{class:"space-y-4"},{default:l(()=>[s("div",null,[t(e(y),{for:"customer_id"},{default:l(()=>[d(a(e(o)("customer"))+" *",1)]),_:1}),t(e(S),{modelValue:e(r).customer_id,"onUpdate:modelValue":i[1]||(i[1]=n=>e(r).customer_id=n),required:"",disabled:!m.value},{default:l(()=>[t(e(F),null,{default:l(()=>[t(e(L),{placeholder:"Select a customer"})]),_:1}),t(e(N),null,{default:l(()=>[t(e(U),{value:f.invoice.customer.id},{default:l(()=>[d(a(f.invoice.customer.name),1)]),_:1},8,["value"])]),_:1})]),_:1},8,["modelValue","disabled"])]),s("div",null,[t(e(y),{for:"ar_account_id"},{default:l(()=>[d(a(e(o)("arAccount")),1)]),_:1}),t(e(S),{modelValue:e(r).ar_account_id,"onUpdate:modelValue":i[2]||(i[2]=n=>e(r).ar_account_id=n),disabled:!m.value},{default:l(()=>[t(e(F),{id:"ar_account_id"},{default:l(()=>[t(e(L),{placeholder:e(o)("useCompanyDefault")},null,8,["placeholder"])]),_:1}),t(e(N),null,{default:l(()=>[t(e(U),{value:"__none"},{default:l(()=>[d(a(e(o)("useCompanyDefault")),1)]),_:1}),(b(!0),$(k,null,C(u.arAccounts||[],n=>(b(),T(e(U),{key:n.id,value:n.id},{default:l(()=>[d(a(n.code)+" — "+a(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])])]),_:1})]),_:1}),t(e(g),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(I),null,{default:l(()=>[d(a(e(o)("invoiceDetails")),1)]),_:1}),t(e(j),null,{default:l(()=>[d(a(e(o)("invoiceDetailsHelper")),1)]),_:1})]),_:1}),t(e(h),{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},{default:l(()=>[s("div",null,[t(e(y),{for:"invoice_date"},{default:l(()=>[d(a(e(o)("invoiceDate"))+" *",1)]),_:1}),t(e(V),{id:"invoice_date",modelValue:e(r).invoice_date,"onUpdate:modelValue":i[3]||(i[3]=n=>e(r).invoice_date=n),type:"date",required:"",disabled:!m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(y),{for:"due_date"},{default:l(()=>[d(a(e(o)("dueDate")),1)]),_:1}),t(e(V),{id:"due_date",modelValue:e(r).due_date,"onUpdate:modelValue":i[4]||(i[4]=n=>e(r).due_date=n),type:"date",disabled:!m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(y),{for:"reference"},{default:l(()=>[d(a(e(o)("reference")),1)]),_:1}),t(e(V),{id:"reference",modelValue:e(r).reference,"onUpdate:modelValue":i[5]||(i[5]=n=>e(r).reference=n),placeholder:"PO number or reference",disabled:!m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(y),{for:"payment_terms"},{default:l(()=>[d(a(e(o)("paymentTerms"))+" ("+a(e(o)("days"))+")",1)]),_:1}),t(e(V),{id:"payment_terms",modelValue:e(r).payment_terms,"onUpdate:modelValue":i[6]||(i[6]=n=>e(r).payment_terms=n),modelModifiers:{number:!0},type:"number",min:"0",max:"365",disabled:!m.value},null,8,["modelValue","disabled"])])]),_:1})]),_:1}),t(e(g),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(I),null,{default:l(()=>[d(a(e(o)("items")),1)]),_:1}),t(e(j),null,{default:l(()=>[d(a(e(o)("lineItemsHelper")),1)]),_:1})]),_:1}),t(e(h),{class:"space-y-4"},{default:l(()=>[s("div",ue,[s("div",re,a(e(o)("description")),1),s("div",ce,a(e(o)("quantity")),1),s("div",me,a(e(o)("unitPrice")),1),s("div",_e,a(e(o)("incomeAccount")),1),s("div",pe,a(e(o)("total")),1)]),(b(!0),$(k,null,C(p.value,(n,v)=>(b(),$("div",{key:v,class:"grid grid-cols-12 gap-2"},[s("div",fe,[t(e(V),{modelValue:n.description,"onUpdate:modelValue":c=>n.description=c,placeholder:"Item description",onInput:c=>A(v,"description",c.target.value),required:"",disabled:!m.value},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"])]),s("div",ve,[t(e(V),{modelValue:n.quantity,"onUpdate:modelValue":c=>n.quantity=c,modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",onInput:c=>A(v,"quantity",parseFloat(c.target.value)||0),required:"",disabled:!m.value},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"])]),s("div",be,[t(e(V),{modelValue:n.unit_price,"onUpdate:modelValue":c=>n.unit_price=c,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",onInput:c=>A(v,"unit_price",parseFloat(c.target.value)||0),required:"",disabled:!m.value},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"])]),s("div",ye,[t(e(S),{modelValue:n.income_account_id,"onUpdate:modelValue":c=>n.income_account_id=c,disabled:!m.value},{default:l(()=>[t(e(F),null,{default:l(()=>[t(e(L),{placeholder:"Income acct"})]),_:1}),t(e(N),null,{default:l(()=>[t(e(U),{value:"__none"},{default:l(()=>[...i[9]||(i[9]=[d("Use default",-1)])]),_:1}),(b(!0),$(k,null,C(u.revenueAccounts||[],c=>(b(),T(e(U),{key:c.id,value:c.id},{default:l(()=>[d(a(c.code)+" — "+a(c.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])]),s("div",Ve,a(q(n.quantity*n.unit_price)),1)]))),128)),t(e(D),{type:"button",variant:"outline",onClick:O,class:"w-full",disabled:!m.value},{default:l(()=>[t(e(ae),{class:"mr-2 h-4 w-4"}),d(" "+a(e(o)("addLineItem")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),t(e(g),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(I),null,{default:l(()=>[d(a(e(o)("amountSummary")),1)]),_:1})]),_:1}),t(e(h),{class:"space-y-2"},{default:l(()=>[s("div",$e,[s("span",null,a(e(o)("subtotal"))+":",1),s("span",null,a(q(B.value)),1)]),s("div",ge,[s("span",null,a(e(o)("tax"))+":",1),s("span",null,a(q(M.value)),1)]),s("div",he,[s("span",null,a(e(o)("total"))+":",1),s("span",null,a(q(K.value)),1)])]),_:1})]),_:1}),t(e(g),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(I),null,{default:l(()=>[d(a(e(o)("additionalInformation")),1)]),_:1})]),_:1}),t(e(h),{class:"space-y-4"},{default:l(()=>[s("div",null,[t(e(y),{for:"description"},{default:l(()=>[d(a(e(o)("description")),1)]),_:1}),t(e(E),{id:"description",modelValue:e(r).description,"onUpdate:modelValue":i[7]||(i[7]=n=>e(r).description=n),placeholder:"Invoice description or internal notes",rows:"3",disabled:!m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(y),{for:"notes"},{default:l(()=>[d(a(e(o)("customerNotes")),1)]),_:1}),t(e(E),{id:"notes",modelValue:e(r).notes,"onUpdate:modelValue":i[8]||(i[8]=n=>e(r).notes=n),placeholder:"Notes that will be visible to the customer",rows:"3",disabled:!m.value},null,8,["modelValue","disabled"])])]),_:1})]),_:1})],32)]),_:1},8,["title","breadcrumbs"])],64))}});export{st as default};
