import{d as S,x as T,s as L,c as v,a as t,u as e,h as P,w as d,b as n,y as B,O as E,e as r,t as o,o as f,F as y,r as $,am as I,i as N}from"./app-B-wLZQl0.js";import{_ as z}from"./PageShell.vue_vue_type_script_setup_true_lang-CS74Goxj.js";import{_ as w}from"./index-D8JUok4n.js";import{_ as c}from"./Input.vue_vue_type_script_setup_true_lang-E2jwtM0f.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-By03EcqK.js";import{_ as k,a as q,b as F,c as C,d as g}from"./SelectValue.vue_vue_type_script_setup_true_lang-QDn6lJI8.js";import{u as O}from"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DKxjvTPB.js";import{P as G}from"./plus-C63jdNg7.js";import{T as H}from"./trash-2-BxVbfljz.js";import{S as J}from"./save-CBmuHaqJ.js";import{F as K}from"./file-text-CFHWSPvd.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-CAfRB85X.js";import"./loader-circle-BSwxCoSE.js";import"./createLucideIcon-CbxkoCx6.js";import"./info-_qQ0Rbsf.js";import"./circle-check-YKnAkXoj.js";import"./useForwardExpose-Ca12vFmR.js";import"./index-a73qSWOM.js";import"./VisuallyHidden-BZkMfMV2.js";import"./Collection-DN_gmv-a.js";import"./PopperContent-BDPRX1DE.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./check-DogY6QNG.js";import"./ohash.D__AXeF1-C-E83dC9.js";import"./nullish-CHIgUVhi.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./RovingFocusGroup-ChUfgJPy.js";import"./building-2-DLYGST8U.js";import"./index-Buy61MQA.js";import"./settings-B8OaYlkV.js";import"./users-CkYIFvpU.js";import"./calendar-B0yi2zLg.js";import"./VisuallyHiddenInput-CgZzfdZ2.js";const Q={class:"grid gap-4 md:grid-cols-2"},R=["disabled"],W={value:""},X=["value"],Y={class:"space-y-3"},Z={class:"flex items-center justify-between"},ee={class:"text-lg font-semibold"},te={class:"space-y-4"},le={class:"md:col-span-2"},ne={class:"flex items-end justify-between gap-2"},ae={class:"grid gap-2 md:w-1/2"},oe={class:"flex justify-between text-sm"},de={class:"flex justify-between text-sm"},ie={class:"flex justify-between text-sm"},ue={class:"flex justify-between text-base font-semibold"},se={class:"flex justify-end gap-3"},Oe=S({__name:"Edit",props:{company:{},vendors:{},bill:{},expenseAccounts:{},apAccounts:{}},setup(V){const s=V,{t:a}=O(),j=[{title:a("dashboard"),href:`/${s.company.slug}`},{title:a("bills"),href:`/${s.company.slug}/bills`},{title:s.bill.id,href:`/${s.company.slug}/bills/${s.bill.id}`},{title:a("edit"),href:`/${s.company.slug}/bills/${s.bill.id}/edit`}],i=T({vendor_id:s.bill.vendor_id,bill_date:s.bill.bill_date,due_date:s.bill.due_date,currency:s.bill.currency,base_currency:s.bill.base_currency,payment_terms:s.bill.payment_terms,notes:s.bill.notes??"",internal_notes:s.bill.internal_notes??"",ap_account_id:s.bill.ap_account_id??"",line_items:s.bill.line_items.map(b=>({...b,expense_account_id:b.expense_account_id??""}))}),x=L(()=>{const b=i.line_items.reduce((u,p)=>u+(Number(p.quantity)||0)*(Number(p.unit_price)||0),0),m=i.line_items.reduce((u,p)=>{const U=(Number(p.quantity)||0)*(Number(p.unit_price)||0);return u+U*((Number(p.tax_rate)||0)/100)},0),l=i.line_items.reduce((u,p)=>{const U=(Number(p.quantity)||0)*(Number(p.unit_price)||0);return u+U*((Number(p.discount_rate)||0)/100)},0),h=b+m-l;return{subtotal:b,tax:m,discount:l,total:h}}),A=()=>i.line_items.push({description:"",quantity:1,unit_price:0,tax_rate:0,discount_rate:0,account_id:""}),D=b=>{i.line_items.length>1&&i.line_items.splice(b,1)},M=()=>{i.put(`/${s.company.slug}/bills/${s.bill.id}`,{preserveScroll:!0})};return(b,m)=>(f(),v(y,null,[t(e(P),{title:`${e(a)("edit")} ${e(a)("bills")}`},null,8,["title"]),t(z,{title:`${e(a)("edit")} ${e(a)("bills")}`,breadcrumbs:j,icon:e(K)},{default:d(()=>[n("form",{class:"space-y-6",onSubmit:B(M,["prevent"])},[n("div",Q,[n("div",null,[t(e(_),{for:"vendor_id"},{default:d(()=>[r(o(e(a)("vendor")),1)]),_:1}),E(n("select",{id:"vendor_id","onUpdate:modelValue":m[0]||(m[0]=l=>e(i).vendor_id=l),class:"w-full rounded border px-3 py-2",disabled:!["draft","received"].includes(V.bill.status)},[n("option",W,o(e(a)("selectVendor")),1),(f(!0),v(y,null,$(V.vendors,l=>(f(),v("option",{key:l.id,value:l.id},o(l.name),9,X))),128))],8,R),[[I,e(i).vendor_id]])]),n("div",null,[t(e(_),{for:"bill_date"},{default:d(()=>[r(o(e(a)("billDate")),1)]),_:1}),t(e(c),{id:"bill_date",modelValue:e(i).bill_date,"onUpdate:modelValue":m[1]||(m[1]=l=>e(i).bill_date=l),type:"date",disabled:!["draft","received"].includes(V.bill.status)},null,8,["modelValue","disabled"])]),n("div",null,[t(e(_),{for:"due_date"},{default:d(()=>[r(o(e(a)("dueDate")),1)]),_:1}),t(e(c),{id:"due_date",modelValue:e(i).due_date,"onUpdate:modelValue":m[2]||(m[2]=l=>e(i).due_date=l),type:"date"},null,8,["modelValue"])]),n("div",null,[t(e(_),{for:"currency"},{default:d(()=>[r(o(e(a)("currency")),1)]),_:1}),t(e(c),{id:"currency",modelValue:e(i).currency,"onUpdate:modelValue":m[3]||(m[3]=l=>e(i).currency=l),maxlength:"3",disabled:""},null,8,["modelValue"])]),n("div",null,[t(e(_),{for:"payment_terms"},{default:d(()=>[r(o(e(a)("paymentTerms"))+" ("+o(e(a)("days"))+")",1)]),_:1}),t(e(c),{id:"payment_terms",modelValue:e(i).payment_terms,"onUpdate:modelValue":m[4]||(m[4]=l=>e(i).payment_terms=l),modelModifiers:{number:!0},type:"number",min:"0",max:"365"},null,8,["modelValue"])]),n("div",null,[t(e(_),{for:"ap_account_id"},{default:d(()=>[r(o(e(a)("apAccount")),1)]),_:1}),t(e(k),{modelValue:e(i).ap_account_id,"onUpdate:modelValue":m[5]||(m[5]=l=>e(i).ap_account_id=l)},{default:d(()=>[t(e(q),{id:"ap_account_id"},{default:d(()=>[t(e(F),{placeholder:e(a)("useCompanyDefault")},null,8,["placeholder"])]),_:1}),t(e(C),null,{default:d(()=>[t(e(g),{value:"__none"},{default:d(()=>[r(o(e(a)("useCompanyDefault")),1)]),_:1}),(f(!0),v(y,null,$(s.apAccounts||[],l=>(f(),N(e(g),{key:l.id,value:l.id},{default:d(()=>[r(o(l.code)+" — "+o(l.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",null,[t(e(_),{for:"notes"},{default:d(()=>[r(o(e(a)("notes")),1)]),_:1}),t(e(c),{id:"notes",modelValue:e(i).notes,"onUpdate:modelValue":m[6]||(m[6]=l=>e(i).notes=l)},null,8,["modelValue"])]),n("div",null,[t(e(_),{for:"internal_notes"},{default:d(()=>[r(o(e(a)("internalNotes")),1)]),_:1}),t(e(c),{id:"internal_notes",modelValue:e(i).internal_notes,"onUpdate:modelValue":m[7]||(m[7]=l=>e(i).internal_notes=l)},null,8,["modelValue"])])]),n("div",Y,[n("div",Z,[n("div",ee,o(e(a)("lineItems")),1),t(e(w),{type:"button",variant:"outline",onClick:A},{default:d(()=>[t(e(G),{class:"mr-2 h-4 w-4"}),r(" "+o(e(a)("addLineItem")),1)]),_:1})]),n("div",te,[(f(!0),v(y,null,$(e(i).line_items,(l,h)=>(f(),v("div",{key:h,class:"grid gap-3 rounded border p-3 md:grid-cols-6"},[n("div",le,[t(e(_),null,{default:d(()=>[r(o(e(a)("description")),1)]),_:1}),t(e(c),{modelValue:l.description,"onUpdate:modelValue":u=>l.description=u,required:""},null,8,["modelValue","onUpdate:modelValue"])]),n("div",null,[t(e(_),null,{default:d(()=>[r(o(e(a)("quantity")),1)]),_:1}),t(e(c),{modelValue:l.quantity,"onUpdate:modelValue":u=>l.quantity=u,modelModifiers:{number:!0},type:"number",min:"0.01",step:"0.01",required:""},null,8,["modelValue","onUpdate:modelValue"])]),n("div",null,[t(e(_),null,{default:d(()=>[r(o(e(a)("unitPrice")),1)]),_:1}),t(e(c),{modelValue:l.unit_price,"onUpdate:modelValue":u=>l.unit_price=u,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",required:""},null,8,["modelValue","onUpdate:modelValue"])]),n("div",null,[t(e(_),null,{default:d(()=>[r(o(e(a)("taxPercent")),1)]),_:1}),t(e(c),{modelValue:l.tax_rate,"onUpdate:modelValue":u=>l.tax_rate=u,modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",null,[t(e(_),null,{default:d(()=>[r(o(e(a)("discountPercent")),1)]),_:1}),t(e(c),{modelValue:l.discount_rate,"onUpdate:modelValue":u=>l.discount_rate=u,modelModifiers:{number:!0},type:"number",min:"0",max:"100",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",null,[t(e(_),null,{default:d(()=>[r(o(e(a)("expenseAccount")),1)]),_:1}),t(e(k),{modelValue:l.expense_account_id,"onUpdate:modelValue":u=>l.expense_account_id=u},{default:d(()=>[t(e(q),null,{default:d(()=>[t(e(F),{placeholder:e(a)("selectAccount")},null,8,["placeholder"])]),_:1}),t(e(C),null,{default:d(()=>[t(e(g),{value:"__none"},{default:d(()=>[r(o(e(a)("useDefault")),1)]),_:1}),(f(!0),v(y,null,$(s.expenseAccounts||[],u=>(f(),N(e(g),{key:u.id,value:u.id},{default:d(()=>[r(o(u.code)+" — "+o(u.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),n("div",ne,[t(e(w),{type:"button",variant:"destructive",size:"icon",onClick:u=>D(h)},{default:d(()=>[t(e(H),{class:"h-4 w-4"})]),_:1},8,["onClick"])])]))),128))])]),n("div",ae,[n("div",oe,[n("span",null,o(e(a)("subtotal")),1),n("span",null,o(x.value.subtotal.toFixed(2)),1)]),n("div",de,[n("span",null,o(e(a)("tax")),1),n("span",null,o(x.value.tax.toFixed(2)),1)]),n("div",ie,[n("span",null,o(e(a)("discount")),1),n("span",null,o(x.value.discount.toFixed(2)),1)]),n("div",ue,[n("span",null,o(e(a)("total")),1),n("span",null,o(x.value.total.toFixed(2)),1)])]),n("div",se,[t(e(w),{type:"submit"},{default:d(()=>[t(e(J),{class:"mr-2 h-4 w-4"}),r(" "+o(e(a)("saveChanges")),1)]),_:1})])],32)]),_:1},8,["title","icon"])],64))}});export{Oe as default};
