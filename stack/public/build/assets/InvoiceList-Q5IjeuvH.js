import{j as te,q as ae,r as c,k as F,s as se,y as le,c as P,o as b,a,d as o,t as v,e as s,w as i,m as L,h as N,i as oe,p as E}from"./app-DjFlEUH4.js";import{s as u,a as R}from"./index-DL9KtRp0.js";import{s as ie,a as p}from"./index-DgqSODAa.js";import{s as re}from"./index-sAMPWKi9.js";import{s as T}from"./index-CXOcYUhh.js";import{s as ne}from"./index-424M1LzA.js";import{s as de}from"./index-CEuCntvK.js";import{s as ce}from"./index-jrbmM0En.js";import{C as ue,s as me}from"./CompanySwitcher-DfMLVd5D.js";import{s as ve}from"./index-zYy9pXTp.js";import{s as pe}from"./index-CLnL3lam.js";import{C as fe}from"./CommandPalette-BP-Quzwc.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CyPBiJ0T.js";import"./index-CyCOy2Ll.js";import"./index-Dp6GxYCd.js";import"./index-CpMPr0UE.js";import"./index-Cl6iUony.js";import"./index-CKALDcO3.js";import"./index-di-bTznt.js";const ge={class:"min-h-screen bg-gray-50 dark:bg-gray-900"},xe={class:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},be={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ke={class:"flex justify-between items-center h-16"},we={class:"flex items-center space-x-4"},_e={class:"text-xl font-semibold text-gray-900 dark:text-white"},he={class:"flex items-center space-x-4"},Se={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Ce={class:"flex justify-between items-center"},Fe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Pe={class:"mt-4 flex justify-end"},Ee={class:"flex justify-between items-center"},De={class:"text-sm text-gray-600 dark:text-gray-400"},Ie={key:0,class:"flex justify-center py-12"},je={key:1,class:"text-center py-12"},$e={class:"flex justify-between items-center"},Ve={class:"flex space-x-2"},Oe={class:"font-medium text-blue-600 dark:text-blue-400 cursor-pointer hover:underline"},Ae={class:"text-gray-900 dark:text-white"},Le={class:"text-gray-600 dark:text-gray-400"},Ne={class:"text-gray-600 dark:text-gray-400"},Re={class:"font-medium text-gray-900 dark:text-white"},Te={class:"flex space-x-2"},Ue={class:"text-center"},Me={class:"text-gray-600 dark:text-gray-400"},ze={__name:"InvoiceList",emits:["invoice-selected"],setup(Be,{emit:U}){const{t:k}=te(),D=ae(),M=U,I=c(),z=c(),r=c(),y=c(!1),_=c([]),h=c([]),S=c(0),n=c({global:{value:null},status:{value:null},customer:{value:null},date_range:{value:null},amount_range:{value:null}}),m=c({first:0,rows:25,sortField:null,sortOrder:null}),g=c(!1),x=c(null),B=[{label:"Draft",value:"draft"},{label:"Sent",value:"sent"},{label:"Paid",value:"paid"},{label:"Partially Paid",value:"partially_paid"},{label:"Overdue",value:"overdue"},{label:"Cancelled",value:"cancelled"}];F(()=>D.props.current_company),F(()=>D.props.auth?.user);const j=F(()=>_.value.length>0),f=async()=>{y.value=!0;try{const t=new URLSearchParams({page:Math.floor(m.value.first/m.value.rows)+1,per_page:m.value.rows,...Object.fromEntries(Object.entries(n.value).map(([l,w])=>[l,w.value]))});m.value.sortField&&(t.append("sort_by",m.value.sortField),t.append("sort_order",m.value.sortOrder===1?"asc":"desc"));const e=await fetch(`/api/v1/invoices?${t}`),d=await e.json();e.ok?(_.value=d.data||[],S.value=d.total||0):r.value.add({severity:"error",summary:"Error",detail:d.message||"Failed to load invoices",life:3e3})}catch(t){console.error("Failed to load invoices:",t),r.value.add({severity:"error",summary:"Network Error",detail:"Failed to load invoices",life:3e3})}finally{y.value=!1}},q=t=>{m.value=t,f()},K=t=>{m.value=t,f()},C=()=>{m.value.first=0,f()},X=()=>{Object.keys(n.value).forEach(t=>{n.value[t].value=null}),C()},G=(t,e="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(t),$=t=>new Date(t).toLocaleDateString(),H=t=>({draft:"secondary",sent:"info",paid:"success",partially_paid:"warning",overdue:"danger",cancelled:"danger"})[t]||"info",V=t=>{M("invoice-selected",t),E.visit(`/invoicing/${t.id}`)},O=()=>{E.visit("/invoicing/create")},J=t=>{E.visit(`/invoicing/${t.id}/edit`)},Q=async t=>{try{const e=await fetch(`/api/v1/invoices/${t.id}/duplicate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}});if(e.ok)r.value.add({severity:"success",summary:"Success",detail:"Invoice duplicated successfully",life:3e3}),f();else{const d=await e.json();r.value.add({severity:"error",summary:"Error",detail:d.message||"Failed to duplicate invoice",life:3e3})}}catch(e){console.error("Failed to duplicate invoice:",e),r.value.add({severity:"error",summary:"Network Error",detail:"Failed to duplicate invoice",life:3e3})}},W=t=>{x.value=t,g.value=!0},Y=async()=>{if(x.value)try{const t=await fetch(`/api/v1/invoices/${x.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}});if(t.ok)r.value.add({severity:"success",summary:"Success",detail:"Invoice deleted successfully",life:3e3}),g.value=!1,x.value=null,f();else{const e=await t.json();r.value.add({severity:"error",summary:"Error",detail:e.message||"Failed to delete invoice",life:3e3})}}catch(t){console.error("Failed to delete invoice:",t),r.value.add({severity:"error",summary:"Network Error",detail:"Failed to delete invoice",life:3e3})}},Z=async t=>{try{const e=await fetch(`/api/v1/invoices/${t.id}/send`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")}});if(e.ok)r.value.add({severity:"success",summary:"Success",detail:"Invoice sent successfully",life:3e3}),f();else{const d=await e.json();r.value.add({severity:"error",summary:"Error",detail:d.message||"Failed to send invoice",life:3e3})}}catch(e){console.error("Failed to send invoice:",e),r.value.add({severity:"error",summary:"Network Error",detail:"Failed to send invoice",life:3e3})}},A=async()=>{try{const t=new URLSearchParams({format:"csv",...Object.fromEntries(Object.entries(n.value).map(([e,d])=>[e,d.value]))});window.open(`/api/v1/invoices/export?${t}`,"_blank"),r.value.add({severity:"success",summary:"Export Started",detail:"Invoice export is being prepared",life:3e3})}catch(t){console.error("Failed to export invoices:",t),r.value.add({severity:"error",summary:"Export Error",detail:"Failed to export invoices",life:3e3})}},ee=t=>[{label:"View",icon:"fas fa-eye",command:()=>V(t)},{label:"Edit",icon:"fas fa-edit",command:()=>J(t),disabled:t.status==="paid"||t.status==="cancelled"},{label:"Duplicate",icon:"fas fa-copy",command:()=>Q(t)},{label:"Send",icon:"fas fa-paper-plane",command:()=>Z(t),disabled:t.status==="draft"},{separator:!0},{label:"Delete",icon:"fas fa-trash",command:()=>W(t),disabled:t.status==="paid",class:"text-red-600 dark:text-red-400"}];return se(()=>{f()}),(t,e)=>{const d=le("tooltip");return b(),P("div",ge,[a("div",xe,[a("div",be,[a("div",ke,[a("div",we,[e[8]||(e[8]=a("i",{class:"fas fa-file-invoice text-2xl text-blue-600 dark:text-blue-400"},null,-1)),a("h1",_e,v(s(k)("invoicing.invoices")),1)]),a("div",he,[o(ue),o(fe,{ref_key:"commandPalette",ref:z},null,512),o(s(u),{onClick:A,icon:"fas fa-download",label:"Export",text:""}),o(s(u),{onClick:O,icon:"fas fa-plus",label:s(k)("invoicing.create_invoice")},null,8,["label"])])])])]),a("div",Se,[o(s(R),{class:"mb-6 shadow-md"},{title:i(()=>[a("div",Ce,[e[9]||(e[9]=a("span",null,"Filters",-1)),o(s(u),{onClick:X,icon:"fas fa-times",label:"Clear",text:"",size:"small"})])]),content:i(()=>[a("div",Fe,[a("div",null,[e[10]||(e[10]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Search ",-1)),o(s(T),{modelValue:n.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value.global.value=l),placeholder:"Search invoices...",class:"w-full"},null,8,["modelValue"])]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Status ",-1)),o(s(ne),{modelValue:n.value.status.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.status.value=l),options:B,optionLabel:"label",optionValue:"value",placeholder:"All Statuses",class:"w-full",showClear:""},null,8,["modelValue"])]),a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Customer ",-1)),o(s(T),{modelValue:n.value.customer.value,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.customer.value=l),placeholder:"Customer name...",class:"w-full"},null,8,["modelValue"])]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Date Range ",-1)),o(s(de),{modelValue:n.value.date_range.value,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.date_range.value=l),selectionMode:"range",placeholder:"Select dates...",class:"w-full",showButtonBar:""},null,8,["modelValue"])])]),a("div",Pe,[o(s(u),{onClick:C,icon:"fas fa-filter",label:"Apply Filters"})])]),_:1}),o(s(R),{class:"shadow-md"},{title:i(()=>[a("div",Ee,[a("span",null,v(s(k)("invoicing.invoice_list")),1),a("div",De,v(S.value)+" total invoices ",1)])]),content:i(()=>[y.value&&!j.value?(b(),P("div",Ie,[o(s(pe))])):!j.value&&!y.value?(b(),P("div",je,[e[14]||(e[14]=a("i",{class:"fas fa-file-invoice text-4xl text-gray-400 mb-4"},null,-1)),e[15]||(e[15]=a("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," No invoices found ",-1)),e[16]||(e[16]=a("p",{class:"text-gray-600 dark:text-gray-400 mb-4"}," Get started by creating your first invoice ",-1)),o(s(u),{onClick:O,icon:"fas fa-plus",label:s(k)("invoicing.create_invoice")},null,8,["label"])])):(b(),L(s(ie),{key:2,value:_.value,paginator:!0,rows:25,totalRecords:S.value,lazy:!0,loading:y.value,onPage:q,onSort:K,onFilter:C,selection:h.value,"onUpdate:selection":e[5]||(e[5]=l=>h.value=l),filters:n.value,filterDisplay:"menu",globalFilterFields:["invoice_number","customer.name","amount"],sortMode:"single",dataKey:"id",rowsPerPageOptions:[10,25,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} invoices",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",responsiveLayout:"scroll"},{header:i(()=>[a("div",$e,[e[17]||(e[17]=a("span",{class:"text-xl text-gray-900 dark:text-white"}," Invoice Management ",-1)),a("div",Ve,[h.value.length>0?(b(),L(s(u),{key:0,onClick:A,icon:"fas fa-download",label:"Export Selected",size:"small"})):oe("",!0)])])]),default:i(()=>[o(s(p),{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(s(p),{field:"invoice_number",header:"Invoice #",sortable:""},{body:i(({data:l})=>[a("div",Oe,v(l.invoice_number),1)]),_:1}),o(s(p),{field:"customer.name",header:"Customer",sortable:""},{body:i(({data:l})=>[a("div",Ae,v(l.customer?.name||"N/A"),1)]),_:1}),o(s(p),{field:"invoice_date",header:"Date",sortable:""},{body:i(({data:l})=>[a("div",Le,v($(l.invoice_date)),1)]),_:1}),o(s(p),{field:"due_date",header:"Due Date",sortable:""},{body:i(({data:l})=>[a("div",Ne,v($(l.due_date)),1)]),_:1}),o(s(p),{field:"amount",header:"Amount",sortable:""},{body:i(({data:l})=>[a("div",Re,v(G(l.amount)),1)]),_:1}),o(s(p),{field:"status",header:"Status",sortable:""},{body:i(({data:l})=>[o(s(re),{value:l.status,severity:H(l.status)},null,8,["value","severity"])]),_:1}),o(s(p),{header:"Actions",style:{width:"120px"}},{body:i(({data:l})=>[a("div",Te,[N(o(s(u),{onClick:w=>V(l),icon:"fas fa-eye",text:"",size:"small"},null,8,["onClick"]),[[d,"View Invoice"]]),N(o(s(u),{onClick:e[4]||(e[4]=w=>I.value.toggle(w)),icon:"fas fa-ellipsis-v",text:"",size:"small"},null,512),[[d,"More Actions"]]),o(s(me),{ref_key:"menu",ref:I,model:ee(l),popup:""},null,8,["model"])])]),_:1})]),_:1},8,["value","totalRecords","loading","selection","filters"]))]),_:1})]),o(s(ce),{visible:g.value,"onUpdate:visible":e[7]||(e[7]=l=>g.value=l),modal:"",header:"Confirm Delete",style:{width:"450px"}},{footer:i(()=>[o(s(u),{onClick:e[6]||(e[6]=l=>g.value=!1),label:t.$t("common.cancel"),text:""},null,8,["label"]),o(s(u),{onClick:Y,label:"Delete",severity:"danger",loading:y.value},null,8,["loading"])]),default:i(()=>[a("div",Ue,[e[18]||(e[18]=a("i",{class:"fas fa-exclamation-triangle text-3xl text-red-500 mb-4"},null,-1)),e[19]||(e[19]=a("h4",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"}," Delete Invoice ",-1)),a("p",Me," Are you sure you want to delete invoice "+v(x.value?.invoice_number)+"? This action cannot be undone. ",1)])]),_:1},8,["visible"]),o(s(ve),{ref_key:"toast",ref:r},null,512)])}}},ct=ye(ze,[["__scopeId","data-v-060ac389"]]);export{ct as default};
